/**
 *  Math JavaScript Library v3.0.0
 *  https://github.com/aantthony/javascript-cas
 *  
 * Copyright 2010 Anthony Foster. All rights reserved.
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */(function(b){function e(a){var b=(new Error(a)).stack;if(!b)return console.warn("Deprecated: "+a);console.warn(b.replace(/^Error\: /,"Deprecated: "))}function h(a){function e(a,b,e){var f=[b,d++,e];if(typeof a=="object")for(var g=0;g<a.length;g++)c[a[g]]=f;else c[a]=f}var c={},d=0;a.forEach(function(a){e(a[0],a[1]||l,a[2]===b?2:a[2])}),this.operators=c,h.build.call(this)}function r(){}function s(a,b){var c=n.parse(a,b);return c}function t(a,b){this.A=a||[],this.m=b||[]}function u(a){return a.__proto__=u.prototype,a}function v(a){}function w(a,b){return new s.Conditional(a.cond,b(a.a),b(a.b))}function x(a){this.x=a}function z(a){this.x=a}function E(a,b){this.pre=[]||b,this.s=a,this.vars=0,this.p=Infinity}function I(a,b){var c=s(a,b||I.Global);return c}"use strict";var d,f=new Date,g=String.fromCharCode(215);d=h.prototype,d.precedence=function(a){if(!this.operators[a])throw"Precedence of "+a+" not known!";return this.operators[a][1]},d.postfix=function(a){var b=this.operators[a];return b[0]===0&&b[2]===1},d.unary=function(a){var b=["+","-","±"];return b.indexOf(a)!=-1?"@"+a:!1},d.assoc=function(a){return this.operators[a][1]===!0},d.Number=function(a){var b={0:i.Zero,1:i.One};if(b[a])return b[a];if(/^[\d]+$/.test(a))return new s.Integer(Number(a));if(/^[\d]*\.[\d]+$/.test(a)){var c=a.indexOf("."),d=a.length-c-1,e=Math.pow(10,d),f=Number(a.replace(".",""));return(new s.Rational(f,e)).reduce()}return b[a]||new s.NumericalReal(Number(a))},h.build=function(){function a(a){var d,e=a.length;while((d=a.indexOf("\\begin"))!=-1){var f=a.indexOf("}",d+7),g=a.substring(d+7,f),h="\\end{"+g+"}",i=a.indexOf(h,f),j=a.substring(f+1,i);switch(g){case"matrix":j=j.replace(/\\\:/g,",").replace(/\\\\/g,";"),a=a.split(""),a[d]="[",a.splice(i,h.length-1),a[i]="]",a.splice(f+1,i-f-1,j),a.splice(d+1,f+1-d-1),a=a.join("");break;default:throw new SyntaxError("Latex \\begin{"+g+"} block not understood.")}}while((d=a.indexOf("\\text"))!==-1){var f=a.indexOf("}",d+6),k=a.substring(d+6,f);a=a.split(""),a.splice(d,f-d+1,"\\"+k),a=a.join("")}while((d=a.indexOf("\\frac"))!==-1){var f,l=!1,m=0;for(f=d+5;f<e;f++)if(a[f]==="{")m++;else if(a[f]==="}"){m--;if(!m){l=!0;break}}if(!l)throw new SyntaxError(msg.latexParse);l=!1;if(a[f+1]!=="{")throw new SyntaxError("Unexpected '"+a[f+1]+"' between \\frac operands");var n=f+1,o;for(o=n;o<e;o++)if(a[o]==="{")m++;else if(a[o]==="}"){m--;if(!m){l=!0;break}}if(!l)throw new SyntaxError(msg.latexParse);a=a.split(""),a[d+5]="((",a[f]=")",a[n]="(",a[o]="))",a.splice(n,0,"/"),a.splice(d,5),a=a.join("")}return a=a.replace(/\^([^\{\(])/g,"^{$1}"),a=a.replace(/\\left\|/g,"\\abs("),a=a.replace(/\\right\|/g,")"),a=a.replace(/\\\:/g," "),a=a.replace(/\\\%/g,"%"),a=a.replace(/\\([a-z]+)/g,function(a,d){var e=c[d];return" "+(e!==b?e:"\\"+d)}),a=a.replace(/[\[\{]/g,"("),a=a.replace(/[\]\}]/g,")"),a}var c={cdot:"*",vee:"∨",wedge:"&&",neg:"¬",left:"",right:"",pm:"±",circ:"∘",div:"/",gt:">","left|":"\\abs(","right|":")",times:g,"left(":"(","right)":")","left[":"[","right]":"]",ge:">=",lt:"<",le:"<=",sim:"~",frac:"",backslash:"\\"},d=this.operators,e={string:1,number:2,operator:3,comment:4,parenopen:5,parenclose:6,symbol:7},f="1234567890.",h=["+","-","@","*","/","^","++","=","!",",","@-","@+","_","#","<","<=",">",">=","%",".",g],i="([{",k="}'])",l=h.join("")+i+k+f,m="default",o=[function(){throw"NONE"},function(b){return!1},function(b){return f.indexOf(b[b.length-1])!==-1},function(b){return h.indexOf(b)!==-1},function(b){return b[b.length-1]===" "},function(b){return b.length==1&&i.indexOf(b)!=-1},function(b){return b.length==1&&k.indexOf(b)!=-1},function(b){return/^[A-Za-z]$/.test(b[b.length-1])},function(b){throw new SyntaxError("Invalid character: '"+b+"'")}],o=[function(){throw"NONE"},function(b){return!1},function(b){return b==="."?!1:f.indexOf(b[b.length-1])!==-1},function(b){return h.indexOf(b)!==-1},function(b){return b[b.length-1]===" "},function(b){return b.length==1&&i.indexOf(b)!=-1},function(b){return b.length==1&&k.indexOf(b)!=-1},function(b){return b[0]==="\\"?b.length===1||/^[A-Za-z]$/.test(b[b.length-1]):b.length===1&&/^[A-Za-z]$/.test(b[0])},function(b){throw new SyntaxError("Invalid character: '"+b+"'")}],p=o.map(function(a){return a.name});this.parse=function(c,f){function p(a){var b=k[a];return delete k[a],b}function q(a){if(a.t===e.number||a.t===e.symbol)i.push(a.v);else{var b=d[a.v][2];if(i.length<b)throw new SyntaxError("The '"+a.v+"' operator requires exactly "+b+" operands, whereas only "+i.length+" "+(i.length===1?"was ":"were ")+"supplied");var c=i.splice(-b,b),f=[c[0],c.splice(1)[0]];f.operator=a.v,i.push(f)}}function r(a){a.t===e.symbol&&(a.v[0]==="\\"&&(a.v=a.v.substring(1)),d[a.v]?a.t=e.operator:a.v==="false"?a.v=!1:a.v==="true"?a.v=!0:a.v==="Infinity"?a.v=Infinity:typeof a.v=="string"&&(f[a.v]?a.v=l[a.v]=f[a.v]:k[a.v]?a.v=k[a.v]:a.v=k[a.v]=new s.Symbol.Real(a.v)));if(a.t===e.number||a.t===e.symbol)a.t==e.number&&(a.v=n.Number(a.v)),q(a);if(a.t===e.operator){var b=a,c=d[b.v][1],g=d[b.v][0],i;while(h.length&&(i=h[h.length-1]).t===e.operator&&(g==j&&c<=d[i.v][1]||g!=j&&c<d[i.v][1]))q(h.pop());h.push(b)}a.t===e.parenopen&&h.push(a);if(a.t===e.parenclose){while(h[h.length-1].t!==e.parenopen){if(!h.length)throw new SyntaxError(msg.parenMismatch);q(h.pop())}if(h.pop().t!==e.parenopen)throw"Pop the left parenthesis from the stack: Not found ! "}}function t(a,b){if(b===e.comment)return;b!==e.operator&&b!==e.parenclose?g!==e.parenopen&&g!==e.operator&&t(m,e.operator):b===e.operator&&!n.postfix(a)&&(g===e.parenopen||g===e.operator)&&n.unary(a)&&(a=n.unary(a)),r({v:a,t:b}),g=b}function D(a){if(a===b)return;return a.__proto__===Array.prototype?D(a[0])[a.operator](D(a[1])):a}if(c==="")return b;c=a(c);var g=e.parenopen,h=[],i=[],k={},l={},u=0,v=c.length,w=c[0],x;for(x=1;x<8;x++)if(o[x](w))break;for(u=1;u<v;u++){var y=c[u],z=w+y;if(o[x](z))w=z;else{var A;for(A=1;A<8;A++)if(o[A](y))break;t(w,x),x=A,w=y}}t(w,x);while(h.length){var B,C=(B=h.pop()).t;if(C===e.parenopen||C===e.parenclose)throw"There are mismatched parentheses.";q(B)}if(i.length!==1)throw"Stack not the right size!";var E=D(i[0]);return E.unbound=k,E.bound=l,E}};var i={},j,k,l=j=0,m=k=1,n=new h([[";"],[","],[["=","+=","-=","*=","/=","%=","&=","^=","|="],m],[["?",":"],m,2],[["∨"]],[["&&"]],[["|"]],[["??????"]],[["&"]],[["==","≠","!==","==="]],[["<","<=",">",">="],l],[[">>","<<"]],["±",m,2],[["+"],!0],[["-"],l],[["∫","∑"],m,1],[["*","%"],m],[g,m],[["@+","@-","@±"],m,1],[["¬"],l,1],["default",m,2],["∘",m,2],[["/"]],[["^"]],["!",l,1],[["~"],m,1],[["++","++",".","->"],l,1],[["::"]],[["_"],l,2],["var",m,1],["break",m,0],["throw",m,1],["'",l,1],["√",m,1],["#",m,1]]),o=new h([[";"],[","],[["=","+="]]]);d=r.prototype=Object.create(i),d.reset=function(){this.splice(0)},d.impliesExpression=function(a){return!1},d.learn=function(a){this.equations.push(a)},d=s.prototype,d.valueOf=null,d.identity=function(){return e("Slow"),this},d.toString=null,d.imageURL=function(){return"http://latex.codecogs.com/gif.latex?"+encodeURIComponent(this.s("text/latex").s)},d.image=function(){var a=new Image;return a.src=this.imageURL(),a},d.sub=function(){return this},d.lim=function(a,b){return this.sub(a,b)},d[","]=function(a){return a instanceof s.Statement?new s.Conditional(a,this):s.Vector([this,a])},d["="]=function(a){return new s.Statement(this,a,"=")},d["!="]=function(a){return new s.Statement(this,a,"!=")},d[">"]=function(a){return new s.Statement(this,a,">")},d[">="]=function(a){return new s.Statement(this,a,">=")},d["<"]=function(a){return new s.Statement(this,a,"<")},d["<="]=function(a){return new s.Statement(this,a,"<=")},d["*"]=function(a){return a===i.Zero?a:a===i.One?this:new s.List([this,a],"*")},d[g]=function(a){return this["*"](a)},d.default=function(a){return this["*"](a)},d["/"]=function(a){return new s.List([this,a],"/")},d["+"]=function(a){return new s.List([this,a],"+")},d["-"]=function(a){return new s.List([this,a],"-")},d["@-"]=function(a){return new s.List([this],"@-")},d["^"]=function(a){return new s.List([this,a],"^")},d["%"]=function(a){return new s.List([this,a],"%")},s.List=function(a,b){return a.__proto__=s.List.prototype,a.operator=b,a},d=s.List.prototype=Object.create(d),d.constructor=s.List,d.sub=function(a,b){var c=this[0].sub(a,b);if(this.length===1)return c[this.operator]();var d=this[1].sub(a,b);return c[this.operator||"default"](d)},d["@-"]=function(){return this.operator==="@-"?this[0]:new s.List([this],"@-")},d=t.prototype,d.add=function(a){var b=this.A.indexOf(a);if(b===-1){var c=this.length;this.A[c]=a,this.m[c]=1}else this.m[b]++;return this},d.remove=function(a){var b=this.A.indexOf(a);return this.m[b]--,this},d.intersect=function(a){throw"What is multiset intersection?"},d.map=function(a){return t(Array.prototype.map.call(this.A,a),this.m)},t.fromArray=function(a){throw"NYI";var b,c},d=u.prototype,d.intersect=function(a){var b,c=this.length,d,e=a.length,f=new u([]);for(b=0;b<c;b++)for(d=0;d<e;d++){var g=this[b],h=a[d];if(g===h){f[f.length]=g;break}var j=g["-"](h);if(j===i.Zero){f[f.length]=g;break}}return g},d.union=function(a){return u(Array.prototype.concat.call(this,a))},d.remove=function(a){var b=this.indexOf(a);return this[b]=this[this.length-1],this.length--,this},d.add=function(a){return this.indexOf(a)===-1&&(this[this.length]=a),this},d.map=function(a){return u(Array.prototype.map.call(this,a))},d.compose=function(a){},d.cardinality=function(){return this.length},v.aleph_0={">":function(a){if(a instanceof s.NumericalReal)return s.True}},d=v.prototype=Object.create(u.prototype),d.cardinality=function(){return v.cardinality},s.TruthValue=function(b){},d=s.TruthValue.prototype=Object.create(s.prototype),s.True=new s.TruthValue,s.False=new s.TruthValue,s.False["~"]=function(){return s.True},d["~"]=function(){return s.False},d.V=function(a){return a===s.True?a:this},d["^"]=function(a){return a===s.True?this:a},s.Statement=function(a,b,c){var d=[a,b];return d.operator=c,d.__proto__=s.Statement.prototype,d},d=s.Statement.prototype=Object.create(s.prototype),d.constructor=s.Statement,d["="]=function(){},d["<"]=function(){},d.solve=function(a){var b=this.a["-"](this.b);return b.roots(a)},s.Constant=function(){throw new Error("Expression.Constant created directly")},d=s.Constant.prototype=Object.create(s.prototype),d.simplify=function(){return this},d.differentiate=function(){return i.Zero},d.default=function(a){return this["*"](a)},s.Symbol=function(b){this.symbol=b},d=s.Symbol.prototype=Object.create(s.prototype),d.constructor=s.Symbol,d.differentiate=function(a){return this===a?i.One:i.Zero},d.integrate=function(a){return this===a?(new s.NumericalReal(.5,0))["*"](a["^"](new s.NumericalReal(2,0))):this["*"](a)},d.sub=function(a,b){return this===a?b:this},s.Symbol.Real=function(b){this.symbol=b},d=s.Symbol.Real.prototype=Object.create(s.Symbol.prototype),d.constructor=s.Symbol.Real,d.realimag=function(){return s.List.ComplexCartesian([this,i.Zero])},d.real=function(){return this},d.imag=function(){return i.Zero},d.polar=function(){return s.List.ComplexPolar([s.List.Real([i.abs,this]),s.List.Real([i.arg,this])])},d.abs=function(){return s.List.Real([i.abs,this])},d.arg=function(){return s.List.Real([i.arg,this])},d["+"]=function(a){return a==i.Zero?this:a instanceof s.NumericalReal?new s.List.Real([this,a],"+"):a instanceof s.Symbol.Real?new s.List.Real([this,a],"+"):a instanceof s.Symbol?new s.List([this,a],"+"):a["+"](this)},d["-"]=function(a){return this===a?i.Zero:a instanceof s.Symbol.Real?new s.List.Real([this,a],"-"):a instanceof s.List.Real?a.operator==="@-"?new s.List.Real([this,a[0]],"+"):new s.List.Real([this,a],"-"):a instanceof s.Symbol?new s.List([this,a],"-"):a["@-"]()["+"](this)},d["@+"]=function(a){return s.List.Real([this],"@+")},d["@-"]=function(a){return s.List.Real([this],"@-")},d["*"]=function(a){return a instanceof s.Rational&&a.a===a.b?this:a instanceof s.Rational&&a.a===0?i.Zero:a instanceof s.Symbol.Real?new s.List.Real([this,a],"*"):a instanceof s.List.Real?a["*"](this):a instanceof s.Symbol?new s.List([this,a],"*"):a instanceof s.NumericalReal?new s.List.Real([a,this],"*"):a instanceof s.NumericalComplex?new s.List.Real([this,a],"*"):a instanceof s.List.ComplexCartesian?a["*"](this):a["*"](this)},d.default=d["*"],d["/"]=function(a){if(a instanceof s.Rational&&a.a===a.b)return this;if(a instanceof s.Rational&&a.a===0)throw"Division by zero";return s.List.Real([this,a],"/")},d["^"]=function(a){if(a instanceof s.Rational&&a.a===0)return i.One;if(a instanceof s.Rational&&a.a===a.b)return this;if(a instanceof s.Integer)return s.List.Real([this,a],"^");if(a instanceof s.Rational){var b=a.reduce();if(b.a%2===0)return s.List.Real([this,a],"^")}return s.List([this,a],"^")},d["%"]=function(a){return s.List.Real([this,a],"%")},d.apply=function(a,c){throw"Real.apply"},s.Function=function(a){this.default=a.default,this["text/latex"]=a["text/latex"],this["x-shader/x-fragment"]=a["x-shader/x-fragment"],this["text/javascript"]=a["text/javascript"],this.derivative=a.derivative,this.realimag=a.realimag},d=s.Function.prototype=Object.create(s.prototype),d.constructor=s.Function,d.default=function(a){return},d.differentiate=function(){if(this.derivative)return this.derivative;throw"Function has no derivative defined."},d.s=function(a){if(this[a])return new E(this[a]);throw"Could not compile function into "+a},d["+"]=function(a){var b=new s.Symbol;return new s.Function.Symbolic(this.default(b)["+"](a),[b])},d["@-"]=function(a){var b=new s.Symbol;return new s.Function.Symbolic(this.default(b)["@-"](),[b])},s.Function.Symbolic=function(b,c){this.expr=b,this.symbols=c},d=s.Function.Symbolic.prototype=Object.create(s.Function.prototype),d.constructor=s.Function.Symbolic,d.default=function(a){a.constructor!==s.Vector&&(a=s.Vector([a]));var b=this.expr,c,d=this.symbols.length;if(d!==a.length)throw"Invalid domain. Element of F^"+d+" expected.";for(c=0;c<d;c++)b=b.sub(this.symbols[c],a[c]);return b},s.NumericalComplex=function(a,b){this._real=a,this._imag=b},d=s.NumericalComplex.prototype=Object.create(s.Constant.prototype),d.constructor=s.NumericalComplex,d.real=function(){return new s.NumericalReal(this._real)},d.imag=function(){return new s.NumericalReal(this._imag)},d.realimag=function(){return s.List.ComplexCartesian([new s.NumericalReal(this._real),new s.NumericalReal(this._imag)])},d.conjugate=function(){return new s.NumericalComplex(this._real,-this._imag)},d["+"]=function(a){if(this._real===0&&this._imag===0)return a;if(a instanceof s.NumericalComplex)return new s.NumericalComplex(this._real+a._real,this._imag+a._imag);if(a instanceof s.NumericalReal)return new s.NumericalComplex(this._real+a.value,this._imag);if(a.constructor===s.List.ComplexCartesian)return a["+"](this);if(a.constructor===s.List.ComplexPolar)return a["+"](this);if(a.constructor===s.List.Real)return a["+"](this);if(a.constructor===s.Symbol.Real)return a["+"](this);if(a.constructor===s.List)return a["+"](this);throw"Unknown Type for NumericalComplex +"},d["-"]=function(a){if(this._real===0&&this._imag===0)return a["@-"]();if(a instanceof s.NumericalComplex)return new s.NumericalComplex(this._real-a._real,this._imag-a._imag);if(a.constructor===s.NumericalReal)return new s.NumericalComplex(this._real-a.value,this._imag);if(a.constructor===s.List.ComplexCartesian)return a["@-"]()["+"](this);if(a.constructor===s.List.ComplexPolar)return a["@-"]()["+"](this);if(a.constructor===s.List.Real)return a["@-"]()["+"](this);if(a.constructor===s.Symbol.Real)return a["@-"]()["+"](this);if(a.constructor===s.List)return a["@-"]()["+"](this);throw"Unknown Type for NumericalComplex -"},d["*"]=function(a){if(this._imag===0){if(this._real===0)return i.Zero;if(this._real===1)return a}if(a.constructor===this.constructor)return new s.NumericalComplex(this._real*a._real-this._imag*a._imag,this._real*a._imag+this._imag*a._real);if(a.constructor===s.NumericalReal)return new s.NumericalComplex(this._real*a.value,this._imag*a.value);if(a.constructor===s.List.ComplexCartesian)return a["*"](this);if(a.constructor===s.List.ComplexPolar)return a["*"](this);if(a.constructor===s.List.Real)return a["*"](this);if(a.constructor===s.Symbol.Real)return a["*"](this);if(a.constructor===s.List)return a["*"](this);throw"Unknown Type for NumericalComplex *"},d["/"]=function(a){if(this._imag===0&&this._real===0)return i.Zero;if(a.constructor===this.constructor){var b=a._real*a._real+a._imag*a._imag;return new s.NumericalComplex((this._real*a._real+this._imag*a._imag)/b,(this._imag*a._real-this._real*a._imag)/b)}if(a.constructor===s.NumericalReal)return new s.NumericalComplex(this._real/a.value,this._imag/a.value);if(a.constructor===s.List.ComplexCartesian)return this.realimag()["/"](a);if(a.constructor===s.List.ComplexPolar)return this.polar()["/"](a);if(a.constructor===s.List.Real)return s.List([this,a],"/");if(a.constructor===s.Symbol.Real)return s.List([this,a],"/");if(a.constructor===s.List)return s.List([this,a],"/");throw"Unknown Type for NumericalComplex /"},d["!"]=function(){return i.Gamma.default(this)},function(){return;var a}(),s.Conditional=function(b,c,d){if(c instanceof s.Symbol.Real||c instanceof s.List.Real)return new s.Conditional.Real(b,c,d);this.cond=b,this.a=c,this.b=d||i.undefined},d=s.Conditional.prototype=Object.create(s.prototype),d.constructor=s.Conditional,d.s=function(a){throw"Not real... too confusing"},d.real=function(a){return w(this,function(a){return a.real()})},d.imag=function(a){return w(this,function(a){return a.imag()})},d.realimag=function(a){return w(this,function(a){return a.realimag()})},d.differentiate=function(a){return w(this,function(b){return b.differentiate(a)})},s.Conditional.Real=function(b,c,d){this.cond=b,this.a=c,this.b=d||i.undefined},d=s.Conditional.Real.prototype=Object.create(s.Conditional.prototype),d.constructor=s.Conditional.Real,d.real=function(){return this},d.imag=function(){return i.Zero},d.realimag=function(){return new s.List.ComplexCartesian([this,i.Zero])},d.s=function(a){a!=="text/latex";if(a==="text/javascript"||a=="x-shader/x-fragment"){var b=this.a.s(a),c=this.b.s(a);console.log("code",b,c);var d=this.cond.s(a),e=b.s,f=b.merge(c);return f.merge(d,"("+d.s+") ? "+e+" : "+c.s)}},s.prototype.conjugate=function(){throw"Conjugate"},s.List.prototype.conjugate=function(){var a,b=this.length,c=new Array(b);for(a=0;a<b;a++)c[a]=this[a].conjugate();return s.List(c,this.operator)},s.NumericalReal=function(b){this.value=b},d=s.NumericalReal.prototype=Object.create(s.NumericalComplex.prototype),d.constructor=s.NumericalReal,Object.defineProperty(d,"_real",{get:function(){return this.value}}),d._imag=0,d.real=function(){return this},d.imag=function(){return i.Zero},d.realimag=function(){return s.List.ComplexCartesian([this,i.Zero])},d.conjugate=function(){return this},d["+"]=function(a){return this.value===0?a:a instanceof s.NumericalReal?new s.NumericalReal(this.value+a.value):a["+"](this)},d["@-"]=function(a){return new s.NumericalReal(-this.value)},d["-"]=function(a){return this.value===0?a:a instanceof s.NumericalReal?new s.NumericalReal(this.value-a.value):a["@-"]()["+"](this)},d["%"]=function(a){var b="The modular arithmetic operator '%' is not defined for non-real numbers.";if(this.value===0)return i.Zero;if(a instanceof s.NumericalReal)return new s.NumericalReal(this.value%a.value);if(a.constructor===s.List.Real)return s.List.Real([this,a],"%");if(a.constructor===s.Symbol.Real)return s.List.Real([this,a],"%");throw a.constructor===s.List?"Not sure about this...":a.constructor===s.NumericalComplex?new TypeError(b):a.constructor===s.List.ComplexCartesian?new TypeError(b):a.constructor===s.List.ComplexPolar?new TypeError(b):"Unknown Type for NumericalReal %"},d["*"]=function(a){return a instanceof s.NumericalReal?new s.NumericalReal(this.value*a.value):a["*"](this)},d["/"]=function(a){if(this.value===0)return i.Zero;if(a instanceof s.NumericalReal){if(a.value===0)throw"Division by zero not allowed!";return new s.NumericalReal(this.value/a.value)}if(a.constructor===s.NumericalComplex){var b=a._real*a._real+a._imag*a._imag;return new s.Complex(this.value*a._real/b,-this.value*a._imag/b)}if(a instanceof s.List.ComplexCartesian){var c=s.List.ComplexCartesian([a[0],a[1]["@-"]()]),d=s.NumericalReal(2);return c["*"](this)["/"](a[0]["^"](d)["+"](a[1]["^"](d)))}if(!(a instanceof s.List.ComplexPolar)){if(a instanceof s.List.Real)return s.List.Real([this,a],"/");if(a instanceof s.Symbol.Real)return s.List.Real([this,a],"/");if(a instanceof s.List)return s.List([this,a],"/");throw console.log("Unknown type: ",this,a),"Unknown Type for NumericalReal /"}},d["^"]=function(a){if(this.value===0)return i.Zero;if(this.value===1)return i.One;if(a===i.Zero)return i.One;if(a===i.One)return this;if(a instanceof s.Integer)return new s.NumericalReal(Math.pow(this.value,a.a));if(a instanceof s.NumericalReal){if(this.value>0)return new s.NumericalReal(Math.pow(this.value,a.value));var b=Math.pow(-this.value,a.value),c=Math.PI*a.value;return new s.List.ComplexPolar([new s.NumericalReal(b),new s.NumericalReal(c)])}if(a.constructor===s.NumericalComplex){var d=this.value,e=a._real,f=a._imag;console.error("Bad implementation ( num ^ complex)");var g=.5*Math.log(d*d),h=g*f,j=Math.exp(g*e);return new s.NumericalComplex(j*Math.cos(h),j*Math.sin(h))}if(a.constructor===s.List.ComplexCartesian)return s.List([this,a],"^");if(a.constructor===s.List.ComplexPolar)return s.List([this,a],"^");if(a.constructor===s.List.Real)return this.value>0?s.List.Real([this,a],"^"):s.List([this,a],"^");if(a.constructor===s.Symbol.Real)return this.value>0?s.List.Real([this,a],"^"):s.List([this,a],"^");if(a.constructor===s.List)return s.List([this,a],"^");throw console.error("Unknown Type for NumericalReal ^",a,a instanceof s.NumericalReal)},d[">"]=function(a){if(a instanceof s.NumericalReal)return this.value>a.value?s.True:s.False},d.apply=function(a,c){switch(a){case",":return s.Vector([this,c]);case"^":if(this.value===0)return i.Zero;break;case"+":if(this.value===0)return c;break;case"-":if(this.value===0)return c.apply("@-");break;case b:case"*":if(this.value===1)return c;case"/":if(this.value===0)return i.Zero}if(c===b)switch(a){case"@+":return this;case"@-":return new s.NumericalReal(-this.value);case"++":case"--":throw new TypeError("Postfix "+a+" operator applied to value that is not a reference.");case"+=":case"-=":case"*=":case"/=":throw new ReferenceError("Left side of assignment is not a reference.");case"!":return i.Gamma.apply(b,new s.NumericalReal(this.value+1))}else if(c.constructor===this.constructor)switch(a){case"*":case b:return new s.NumericalReal(this.value*c.value);case"+":return new s.NumericalReal(this.value+c.value);case"-":return new s.NumericalReal(this.value-c.value);case"/":return new s.NumericalReal(this.value/c.value);case"^":if(this.value>0)return new s.NumericalReal(Math.pow(this.value,c.value));var d=Math.pow(-this.value,c.value),e=Math.PI*c.value;return new s.Complex(d*Math.cos(e),d*Math.sin(e));default:}else if(c.constructor===s.Complex)switch(a){case"*":case b:return new s.Complex(this.value*c._real,this.value*c._imag);case"+":return new s.Complex(this.value+c._real,c._imag);case"-":return new s.Complex(this.value-c._real,-c._imag);case"/":var f=c._real*c._real+c._imag*c._imag;return new s.Complex(this.value*c._real/f,-this.value*c._imag/f);case"^":var g=this.value,h=c._real,j=c._imag;console.error("Bad implementation ( num ^ complex)");var k=.5*Math.log(g*g),l=k*j,m=Math.exp(k*h);return new s.Complex(m*Math.cos(l),m*Math.sin(l));default:}else if(c.constructor===s.List.ComplexCartesian)switch(a){case"+":case"-":return s.List.ComplexCartesian([c[0].apply(a,this),c[1]]);case b:a="*";case"*":case"/":return s.List.ComplexCartesian([c[0].apply(a,this),c[1].apply(a,this)]);case"^":return console.warn("ineffecient: NR ^ CL"),this.realimag().apply(a,c)}else if(c.constructor===s.List.ComplexPolar)switch(a){case"+":case"-":case"^":return s.List([this,c],a);case b:a="*";case"*":return s.List.ComplexPolar([c[0].apply(a,this),c[1]]);case"/":return s.List.ComplexPolar([c[0].apply(a,this),c[1]])}else if(c.constructor===s.List.Real)switch(a){case b:a="*";case"*":case"+":case"-":case"/":return s.List.Real([this,c],a);case"^":if(this.value===0)throw"N(0) ^ x";return this.value>0?s.List.Real([this,c],a):s.List.ComplexPolar([(new s.Numerical(-this.value)).apply("^",c),i.pi.apply("*",c)])}else if(c.constructor===s.Symbol.Real)switch(a){case b:a="*";case"*":case"+":case"-":case"/":return s.List.Real([this,c],a);case"^":if(this.value===0)throw"N(0) ^ x";return this.value>0?s.List.Real([this,c],a):s.List.ComplexPolar([s.List.Real([new s.NumericalReal(-this.value),c],"^"),i.pi.apply("*",c)])}throw"?? - real"},s.Rational=function(b,c){this.a=b,this.b=c},d=s.Rational.prototype=Object.create(s.NumericalReal.prototype),d.constructor=s.Rational,d.__defineGetter__("value",function(){return this.a/this.b}),d["+"]=function(a){return this.a===0?a:a instanceof s.Rational?new s.Rational(this.a*a.b+this.b*a.a,this.b*a.b):a.constructor===s.NumericalComplex?new s.NumericalComplex(this.value+a._real,a._imag):a.constructor===s.List.ComplexCartesian?a["+"](this):a.constructor===s.List.ComplexPolar?a["+"](this):a.constructor===s.List.Real?a["+"](this):a.constructor===s.Symbol.Real?a["+"](this):a.constructor===s.List?a["+"](this):(console.warn("Swapped operator order for + with Rational"),a["+"](this))},d["-"]=function(a){return this.a===0?a["@-"]():a instanceof s.Rational?new s.Rational(this.a*a.b-this.b*a.a,this.b*a.b):a.constructor===s.NumericalComplex?new s.NumericalComplex(this.value-a._real,a._imag):a.constructor===s.List.ComplexCartesian?a["@-"]()["+"](this):a.constructor===s.List.ComplexPolar?a["@-"]()["+"](this):a.constructor===s.List.Real?a["@-"]()["+"](this):a.constructor===s.Symbol.Real?a["@-"]()["+"](this):a.constructor===s.List?a["@-"]()["+"](this):(console.warn("Swapped operator order for - with Rational"),a["+"](this))},d["*"]=function(a){return this.a===0?i.Zero:a instanceof this.constructor?new s.Rational(this.a*a.a,this.b*a.b):this.__proto__.__proto__["*"].call(this,a)},d["/"]=function(a){if(this.a===0)return i.Zero;if(a instanceof this.constructor){if(a.a===0)throw"Division By Zero is not defined for Rational numbers!";return(new s.Rational(this.a*a.b,this.b*a.a)).reduce()}return s.NumericalReal.prototype["/"].call(this,a)},d["^"]=function(a){if(a===i.Zero)return i.One;if(a===i.One)return this;if(this.a===0)return i.Zero;if(this.a===this.b)return i.One;if(a instanceof s.Integer)return new s.Rational(Math.pow(this.a,a.a),Math.pow(this.b,a.a));if(a instanceof s.Rational){var b=a.reduce();return b.a%2==0?new s.NumericalReal(Math.pow(Math.pow(this.a,b.a),1/b.b)):s.NumericalReal.prototype["^"].call(this,a)}return s.List([this,a],"^")},d.reduce=function(){function a(b,c){return c===0?b:a(c,b%c)}var b=a(this.b,this.a);return this.a/=b,this.b/=b,this.b===1?new s.Integer(this.a):(this.b<0&&(this.a=-this.a,this.b=-this.b),this)},s.Integer=function(b){this.a=b},d=s.Integer.prototype=Object.create(s.Rational.prototype),d.b=1,d.constructor=s.Integer,d["+"]=function(a){return a instanceof s.Integer?new s.Integer(this.a+a.a):a["+"](this)},d["-"]=function(a){return a instanceof s.Integer?new s.Integer(this.a-a.a):this.__proto__.__proto__["-"].call(this,a)},d["/"]=function(a){return a instanceof s.Integer?this.a%a.a===0?new s.Integer(this.a/a.a):new s.Rational(this.a,a.a):this.__proto__.__proto__["/"].call(this,a)},d["@-"]=function(){return new s.Integer(-this.a)},d["*"]=function(a){return a instanceof s.Integer?new s.Integer(this.a*a.a):a["*"](this)},d["^"]=function(a){if(a instanceof s.Integer)return new s.Integer(Math.pow(this.a,a.a));if(a.constructor===s.Rational){var b=a.reduce();return b.a%2==0?new s.NumericalReal(Math.pow(Math.pow(this.a,b.a),1/b.b)):s.NumericalReal.prototype["^"].call(this,a)}if(a.constructor===s.List.Real||a.constructor===s.Symbol.Real)if(this.a>0)return s.List.Real([this,a],"^");return s.NumericalReal.prototype["^"].call(this,a)},d["%"]=function(a){return a instanceof s.Integer?new s.Integer(this.a%a.a):a.constructor===s.Rational?new s.Rational:a.constructor===s.NumericalReal?new s.NumericalReal(this%a.value):s.List.Real([this,a],"%")},s.List.prototype.differentiate=function(a){switch(this.operator){case b:if(this[0]instanceof s.Function){var c=this[1].differentiate(a);return c===i.Zero?c:this[0].differentiate().default(this[1])["*"](c)};case"*":return this[0].differentiate(a)["*"](this[1])["+"](this[1].differentiate(a)["*"](this[0]));case"@+":case"@-":return this[0].differentiate(a)[this.operator]();case"+":case"-":return this[0].differentiate(a)[this.operator](this[1].differentiate(a));case"^":var d=this[0].differentiate(a),e=this[1].differentiate(a);if(d===i.Zero)return e===i.Zero?i.Zero:e["*"](i.log.default(this[0]))["*"](this);var f=this[0]["^"](this[1]["-"](i.One));return f["*"](d["*"](this[1])["+"](this[0]["*"](i.log.default(this[0]))["*"](e)));case"/":var c=this[0].differentiate(a),g=this[1].differentiate(a);if(g===i.Zero)return c["/"](this[1]);return this[1]["*"](c)["-"](this[0]["*"](g))["/"](this[1]["^"](new s.Integer(2)));default:throw"Cannot differentiate "+this.operator+" operator."}},s.prototype.differentiateN=function(a,b){if(b===0)return this;if(b<=-1)return this.integrateN(a,b);if(b>1)return this.differentiate(a).differentiateN(a,b-1);if(b===1)return this.differentiate(a)},s.Root=function(b,c){this.a=b,this.n=c},d=s.Root.prototype=Object.create(s.NumericalReal),d.constructor=s.Root,d["*"]=function(a){if(a.constructor!==this.constructor)return a["*"](this)},d.__defineGetter__("value",function(){return Math.pow(this.a,1/this.n)}),s.Equation=function(a,b){return a.__proto__=s.Equation.prototype,a.operator=b,a},d=s.Equation.prototype=Object.create(s.List.prototype),d.apply=function(a,b){throw"Operators cannot be applied to equations"},s.List.ComplexPolar=function(a){return a.__proto__=s.List.ComplexPolar.prototype,a},d=s.List.ComplexPolar.prototype=Object.create(s.prototype),d.constructor=s.List.ComplexPolar,d.polar=function(){return this},d.realimag=function(){return s.List.ComplexCartesian([this[0].apply("*",i.cos.apply(b,this[1])),this[0].apply("*",i.sin.apply(b,this[1]))])},d.real=function(){return this[0].apply("*",i.cos.apply(b,this[1]))},d.imag=function(){return this[0].apply("*",i.sin.apply(b,this[1]))},d.conjugate=function(){return s.List.ComplexPolar([this[0],this[1].apply("@-")])},d.differentiate=function(a){return i.e.apply("^",i.i.apply("*",this[1])).apply("*",this[0].differentiate(a).apply("+",i.i.apply("*",this[0]).apply("*",this[1].differentiate(a))))},d.apply=function(a,c){if(c.constructor===this.constructor)switch(a){case b:case"*":return s.List.ComplexPolar([this[0].apply("*",c[0]),this[1].apply("+",c[1])]);case"/":return s.List.ComplexPolar([this[0].apply("/",c[0]),this[1].apply("-",c[1])]);case"+":case"-":case"^":case"!":default:}else if(c.constructor===s.NumericalReal)switch(a){case b:case"*":return s.List.ComplexPolar([this[0].apply("*",c),this[1]]);case"/":return s.List.ComplexPolar([this[0].apply("/",c),this[1]]);case"+":case"-":case"^":return s.List.ComplexPolar([this[0],this[1].apply("*",c)]);case"!":default:}else if(c.constructor===s.Complex)switch(a){case b:case"*":return s.List.ComplexPolar([this[0].apply("*",new s.NumericalReal(c._real)),this[1].apply("+",new s.NumericalReal(c._imag))]);case"/":return s.List.ComplexPolar([this[0].apply("/",new s.NumericalReal(c._real)),this[1].apply("-",new s.NumericalReal(c._imag))]);case"+":case"-":case"^":case"!":default:}},d.abs=function(){return this[0]},d.arg=function(){return this[1]},s.prototype.real=function(){return console.warn("TODO: don't calculate both parts (Expression.prototype.real)"),this.realimag()[0]},s.prototype.imag=function(){return console.warn("TODO: don't calculate both parts (Expression.prototype.imag)"),this.realimag()[1]},s.List.prototype.realimag=function(){console.error("Only the user can call this function"
);switch(this.operator){case b:if(this[0]instanceof s.Function)return this[0].realimag().default(this[1]);case"*":var a=this[0].realimag(),c=this[1].realimag();return s.List.ComplexCartesian([a[0]["*"](c[0])["-"](a[1]["*"](c[1])),a[0]["*"](c[1])["+"](a[1]["*"](c[0]))]);case"@+":case"@-":var a=this[0].realimag();return s.List.ComplexCartesian([a[0][this.operator](),a[1][this.operator]()]);case"+":case"-":var a=this[0].realimag(),c=this[1].realimag();return s.List.ComplexCartesian([a[0][this.operator](c[0]),a[1][this.operator](c[1])]);case"/":var a=this[0].realimag(),c=this[1].realimag(),d=c[0]["*"](c[0])["+"](c[1]["*"](c[1]));return s.List.ComplexCartesian([a[0]["*"](c[0])["+"](a[1]["*"](c[1]))["/"](d),a[1]["*"](c[0])["-"](a[0]["*"](c[1]))["/"](d)]);case"^":var a=this[0].realimag(),c=this[1].realimag(),e=new s.Rational(1,2),f=new s.Integer(2),g=i.log.realimag().default(a),h=g[0],j=g[1],k=h["*"](c[1])["+"](j["*"](c[0])),l=i.e["^"](h["*"](c[0])["-"](j["*"](c[1])));return s.List.ComplexCartesian([l["*"](i.cos.default(k)),l["*"](i.sin.default(k))])}},s.List.ComplexCartesian=function(b){return b.__proto__=s.List.ComplexCartesian.prototype,b},d=s.List.ComplexCartesian.prototype=Object.create(s.prototype),d.constructor=s.List.ComplexCartesian,d.realimag=function(){return this},d.real=function(){return this[0]},d.imag=function(){return this[1]},d.conjugate=function(){return s.List.ComplexCartesian([this[0],this[1].apply("@-")])},d["@-"]=function(a){return new s.List.ComplexCartesian([this[0]["@-"](),this[1]["@-"]()])},d["*"]=function(a){if(a instanceof s.List.ComplexCartesian)return new s.List.ComplexCartesian([this[0]["*"](a[0])["-"](this[1]["*"](a[1])),this[0]["*"](a[1])["+"](this[1]["*"](a[0]))]);if(a instanceof s.List.Real||a instanceof s.Symbol.Real||a instanceof s.NumericalReal)return new s.List.ComplexCartesian([this[0]["*"](a),this[1]["*"](a)])},d["^"]=function(a){if(a instanceof s.Integer){if(a instanceof s.Rational&&a.a===a.b)return this;if(a instanceof s.Rational&&a.a===0)return i.One;var b=a.a,c,a=this[0],d=this[1],e=new s.Integer(-1),f=i.Zero,g=a["^"](new s.Integer(b)),h=1;for(c=1;;c++){if(c===b){var j=d["^"](new s.Integer(c));h===0?g=g["+"](j):h===1?f=f["+"](j):h===2?g=g["-"](j):h===3&&(f=f["-"](j),h=-1);break}var j=a["^"](new s.Integer(b-c))["*"](d["^"](new s.Integer(c)));h===0?g=g["+"](j):h===1?f=f["+"](j):h===2?g=g["-"](j):h===3&&(f=f["-"](j),h=-1),h++}return new s.List.ComplexCartesian([g,f])}return new s.List([this,a],"^")},d["+"]=function(a){if(a instanceof s.List.ComplexCartesian)return new s.List.ComplexCartesian([this[0]]);if(a instanceof s.List.Real||a instanceof s.Symbol.Real||a instanceof s.NumericalReal)return new s.List.ComplexCartesian([this[0]["+"](a),this[1]])},d.differentiate=function(a){return s.List.ComplexCartesian([this[0].differentiate(a),this[1].differentiate(a)])},d.apply=function(c,d){if(d.constructor===this.constructor)switch(c){case"+":case"-":return s.List.ComplexCartesian([this[0].apply(c,d[0]),this[1].apply(c,d[1])]);case b:case"*":return s.List.ComplexCartesian([this[0].apply("*",d[0]).apply("-",this[1].apply("*",d[1])),this[0].apply("*",d[1]).apply("+",this[1].apply("*",d[0]))]);case"/":var e=d[0].apply("*",d[0]).apply("+",d[1].apply("*",d[1]));return s.List.ComplexCartesian([this[0].apply("*",d[0]).apply("+",this[1].apply("*",d[1])).apply("/",e),this[1].apply("*",d[0]).apply("-",this[0].apply("*",d[1])).apply("/",e)]);case"^":var f=new s.NumericalReal(.5,0),g=f.apply("*",i.log.apply(b,this[0].apply("*",this[0]).apply("+",this[1].apply("*",this[1])))),h=i.atan2.apply(b,s.Vector([this[1],this[0]])),j=g.apply("*",d[1]).apply("+",h.apply("*",d[0])),k=i.e.apply("^",g.apply("*",d[0]).apply("-",h.apply("*",d[1])));return s.List.ComplexCartesian([k.apply("*",i.cos.apply(b,j)),k.apply("*",i.sin.apply(b,j))]);case"!":default:}else if(d.constructor===s.List.ComplexPolar)switch(c){case"*":case"/":var e=d[0].apply("*",d[0]),l=d.realimag();return s.List.ComplexCartesian([this[0].apply("*",l[0]).apply("+",a[1].apply("*",l[1])).apply("/",e),this[1].apply("*",l[0]).apply("-",a[0].apply("*",l[1])).apply("/",e)]);case"^":case"+":case"-":return this.apply(c,d.realimag())}else{if(d.constructor===s.Complex)return this.apply(c,d.realimag());if(d.constructor===s.Symbol.Real)return console.error("Duplicated an x! This makes it difficult to solve complex equations, I think"),this.apply(c,d.realimag());if(d.constructor===s.List.Real)return console.error("Duplicated an x! This makes it difficult to solve complex equations, I think"),this.apply(c,d.realimag())}throw"CMPLX.LIST * "+c},s.List.Real=function(c,d){return c.__proto__=s.List.Real.prototype,d!==b&&(c.operator=d),c},d=s.List.Real.prototype=Object.create(s.List.prototype),d.constructor=s.List.Real,d.realimag=function(){return s.List.ComplexCartesian([this,i.Zero])},d.real=function(){return this},d.imag=function(){return i.Zero},d.polar=function(){return s.List.ComplexPolar([s.List.Real([i.abs,this]),s.List.Real([i.arg,this])])},d.abs=function(){return s.List.Real([i.abs,this])},d.arg=function(){return s.List.Real([i.arg,this])},d["+"]=function(a){return this===a?a["*"](new s.Integer(2)):a instanceof s.Rational&&a.a===0?this:a instanceof s.NumericalReal?this.operator==="+"&&this[1]instanceof s.NumericalReal?s.List.Real([this[0],this[1]["+"](a)],this.operator):this.operator==="-"&&this[1]instanceof s.NumericalReal?s.List.Real([this[0],a["-"](this[1])],"+"):s.List.Real([this,a],"+"):a instanceof s.List.Real||a instanceof s.Symbol.Real?s.List.Real([this,a],"+"):a["+"](this)},d["-"]=function(a){return a instanceof s.Rational&&a.a===0?this:a===this?i.Zero:a instanceof s.List.Real?a.operator==="@-"?s.List.Real([this,a[0]],"+"):s.List.Real([this,a],"-"):a instanceof s.Symbol.Real||a instanceof s.NumericalReal?s.List.Real([this,a],"-"):this.realimag()["-"](a)},d["*"]=function(a){return a instanceof s.Rational&&a.a===a.b?this:a instanceof s.Rational&&a.a===0?i.Zero:a instanceof s.NumericalReal?this.operator==="*"||this.operator==="/"&&this[0]instanceof s.NumericalReal?s.List.Real([this[0]["*"](a),this[1]],this.operator):s.List.Real([a,this],"*"):a instanceof s.List.Real||a instanceof s.Symbol.Real?(!(this[0]instanceof s.Function),s.List.Real([this,a],"*")):a["*"](this)},d["/"]=function(a){return a instanceof s.Rational&&a.a===a.b?this:a===this?i.One:a instanceof s.NumericalReal?this.operator==="*"||this.operator==="/"?s.List.Real([this[0]["/"](a),this[1]],this.operator):s.List.Real([this,a],"/"):a instanceof s.List.Real||a instanceof s.Symbol.Real?s.List.Real([this,a],"/"):this.realimag()["/"](a)},d["%"]=function(a){return s.List.Real([this,a],"%")},d["@-"]=function(){return this.operator==="@-"?this[0]:s.List.Real([this],"@-")},d["^"]=function(a){if(a instanceof s.NumericalReal)if(this.operator==="*"||this.operator==="/"&&this[0]instanceof s.NumericalReal)return s.List.Real([this[0]["^"](a),this[1]["^"](a)],this.operator);return s.Symbol.Real.prototype["^"].call(this,a)},s.prototype.polar=function(){var a=this.realimag(),b=new s.Integer(2);return s.List.ComplexPolar([i.sqrt.default(a[0]["^"](b)["+"](a[1]["^"](b))),i.atan2.default(s.Vector([a[1],a[0]]))])},s.prototype.abs=function(){console.warn("SLOW?");var a=this.realimag(),b=new s.Integer(2);return i.sqrt.default(a[0]["^"](b)["+"](a[1]["^"](b)))},s.prototype.arg=function(){console.warn("Slow?");var a=this.realimag();return i.atan2.default(s.Vector([a[1],a[0]]))},s.prototype.factors=function(a,b,c){c(this,!1)},s.prototype.terms=function(a,b,c){c(this,!1)},s.prototype.factorize=function(a){throw"Inefficent";var b,c},s.Symbol.Real.prototype.factors=function(a,b,c){a.indexOf(this)!==-1?b(this,!1):c(this,!1)},s.Symbol.Real.prototype.terms=function(a,b,c){a.indexOf(this)!==-1?b(this,!1):c(this,!1)},s.List.Real.prototype.terms=function(a,b,c){switch(this.operator){case"+":this[0].terms(a,b,c),this[1].terms(a,b,c);return;case"-":this[0].terms(a,b,c),this[1].terms(a,function(a){b(a["@-"]())},function(a){c(a["@-"]())});return;case"*":var d=[],e=i.Zero,f=[],g=i.Zero;this[0].terms(a,function(a){d.push(a)},function(a){e=e["*"](a)}),this[1].terms(a,function(a){f.push(a)},function(a){g=g["*"](a)}),c(e["*"](g));var h=0;for(h=0;h<d.length;h++){var j;for(j=0;j<f.length;j++)b(d[h]["*"](f[j]))}return;case"/":var k=this;if(this[1]instanceof s.Constant){this[0].terms(a,function(a){b(a["/"](k[1]))},function(a){c(a["/"](k[1]))});return}throw"Expansion in denominator required"}},s.List.Real.prototype.factors=function(a,c,d,e){var f=~~(1e3*Math.random());console.log("("+f+") Attempt to find factors of: ",this);switch(this.operator){case"-":case"+":var g=[],h=i.One,j=[],k=i.One;this[0].factors(a,function(a){console.log(f+"< a: ",a),g.push(a)},function(a){console.log(f+"< a_c: ",a),h=h["*"](a)}),this[1].factors(a,function(a){console.log(f+"< b: ",a),j.push(a)},function(a){console.log(f+"< b_c: ",a),k=k["*"](a)});var l=[],m,n=g.length,o,p=j.length,q=i.One,r=i.One;for(m=0;m<n;m++){var s=!1;for(o=0;o<p;o++){if(j[o]===b)continue;if(g[m]===j[o]){l.push(g[m]),j[o]=b,s=!0;break}}s||(q=q["*"](g[m]))}for(o=0;o<p;o++){if(j[o]===b)continue;r=r["*"](j[o])}l.length?(console.log("common:",l,"of: ",g,j),l.forEach(c),console.log("(a,b) = ",q,r),console.log("(a_c,b_c) = ",h,k),c(q["*"](h)["+"](r["*"](k)))):d(this);return;case"*":this[0].factors(a,c,d),this[1].factors(a,c,d);return;case"/":this[0].factors(a,c,d);if(e===!1)return;this[1].factors(a,function(a,b){c(a,!b)},function(a,b){d(a,!b)});return}},window.test=function(a){I(a||"x+x+x+x",c).factors([c.x],function(a){console.log("Y",a)},function(a){console.log("N",a)})},function(){s.prototype.factors=function(a){return new Multiset},s.Symbol.Real.prototype.factors=function(a){var b=new Multiset([this],[1]);return b.vars=[],b},s.List.Real.prototype.factors=function(a){switch(this.operator){case"+":case"-":var b=this[0].factors(a),c=this[0].factors(a);return this.operator==="-"&&c.add(i.One["@-"]()),Multiset([this],[1]);case"*":var b=this[0].factors(a),c=this[1].factors(a);return b.union(c);case"/":var b=this[0].factors(a),c=this[1].factors(a).map(i.One["/"]);return b.union(c);case"@-":return Multiset(this[0].factors(a).add(i.One["@-"]()))}}},s.prototype.roots=function(a){return u([])},s.Symbol.prototype.roots=function(a){return a.indexOf(this)!==-1?u([new Statement(this,i.Zero,"=")]):u([])},s.prototype.dep=function(a){return!1},s.Symbol.Real.prototype.dep=function(a){return a.indexOf(this)!==-1},s.List.prototype.dep=function(a){return this[0].dep(a)?!0:this[1].dep(a)?!0:!1},s.Function.Symbolic.prototype.inverse=function(){},s.List.Real.prototype.roots=function(a){if(this.operator==="*"){var b=this[0].roots(a),c=this[1].roots(a);return b.union(c)}if(this.operator==="+"){var d=i.One;this.factors(a,function(a,b){d=d["*"](a)},function(){},!1);if(d.operator==="*")return d.roots(a);if(!!this[1].dep(a)&&!!this[0].dep(a))throw"Cannot solve";var e=this[0].roots(a),f=this[0].roots(a)}else if(this.operator==="/"){var b=this[0].roots(a);return b}},d=x.prototype=Object.create(s.prototype),d.constructor=x,d["+"]=function(a){if(a instanceof x)throw"Infinitesimal addition";return a},d["/"]=function(a){if(a instanceof x){if(a.x instanceof s.Symbol)return this.x.differentiate(a.x);throw"Confusing infitesimal division"}return this.x=this.x["/"](a),this},d["*"]=function(a){if(a instanceof x)return i.Zero;this.x=this.x["*"](a)},d.s=function(a){if(a!=="text/latex")throw"Infinitesimal numbers cannot be exported to programming languages";var b=this.x.s(a),c=n.precedence("default");return c>b.p&&(b.s="\\left("+b.s+"\\right)"),b.update("d"+b.s,c)},d=z.prototype=Object.create(s.Function.prototype),d.constructor=z,d.default=function(a){return a.differentiate(this.x)},s.List.prototype.lim=function(a,b){switch(this.operator){case"+":case"-":return this[0].lim(a,b)[this.operator](this[1].lim(a,b));case"@-":case"@+":return this[0].lim(a,b)[this.operator]();case"/":var c=this[0].sub(a,b),d=this[1].sub(a,b);if(c===i.Zero&&d===i.Zero)return c=this[0].differentiate(a),d=this[1].differentiate(a),c["/"](d).lim(a,b);return c["/"](d);case"*":var e=this[0].sub(a,b),f=this[1].sub(a,b);if(e===i.Zero&&f==i.Infinity){var c=this[0].differentiate(a),d=i.One["/"](this[1]).differentiate(a);return c["/"](d).lim(a,b)}if(f===i.Zero&&e==i.Infinity){var c=this[0].differentiate(a),d=i.One["/"](this[1]).differentiate(a);return c["/"](d).lim(a,b)}return e["*"](f);case"^":if(this[0]===i.Zero)return i.Zero;if(this[1]===i.Zero&&this[0]!==i.Zero)return i.One;return this.sub(a,b);case"!":return this.sub(a,b)}},s.Vector=function(b){return b.__proto__=s.Vector.prototype,b},d=s.Vector.prototype=Object.create(s.prototype),d.constructor=s.Vector,d[","]=function(a){return a instanceof s.Statement?new s.Conditional(a,this,b):s.Vector(Array.prototype.concat.call(this,[a]))},d.differentiate=function(a){return s.Vector(Array.prototype.map.call(this,function(b){return b.differentiate(a)}))},d.cross=function(a){if(this.length!==3||a.length!==3)throw"Cross product only defined for 3D vectors.";return new s.Vector([this[1].default(a[2])["-"](this[2].default(a[1])),this[2].default(a[0])["-"](this[0].default(a[2])),this[0].default(a[1])["-"](this[1].default(a[0]))])},d[g]=d.cross,d.default=function(a){var b=this.length;if(a instanceof s.Vector){if(b!==a.length)throw"Vector Dimension mismatch.";var c,d=i.Zero;for(c=0;c<b;c++)d=d["+"](this[c].default(a[c]));return d}if(!(a instanceof s.Matrix))return s.Vector(Array.prototype.map.call(this,function(b){return b.default(a)}))},d["*"]=d.default,d["+"]=function(a,b){var c=this.length;if(c!=a.length)throw"Vector Dimension mismatch.";var d,e=new Array(c);for(d=0;d<c;d++)e[d]=this[d][b||"+"](a[d]);return s.Vector(e)},d["-"]=function(a){return d.call(this,a,"-")},d["/"]=function(a){if(a instanceof s.Vector)throw"Vector division not defined";return s.Vector(Array.prototype.map.call(this,function(b){return b["/"](a)}))},d["^"]=function(a){if(a instanceof s.Integer){if(a.a===0)throw"Raised to zero power";if(a.a===1)return this;if(a.a===2){var b=i.Zero,c,d=this.length;for(c=0;c<d;c++)b=b["+"](this[c]["^"](a));return b}return this["^"](new s.Integer(a.a-1))["*"](this)}if(a instanceof s.Rational)return this["^"](a.a)["^"](i.One["/"](a.b));if(a.constructor===s.NumericalComplex)return new s.Complex(this.value+a._real,a._imag);if(a.constructor===s.List.ComplexCartesian)return a["+"](this);if(a.constructor===s.List.ComplexPolar)return a["+"](this);if(a.constructor===s.List.Real)return a["+"](this);if(a.constructor===s.Symbol.Real)return a["+"](this);if(a.constructor===s.List)return a["+"](this);throw"Unknown Type for Vector ^"},d.apply=function(a,c){var d=this.length;switch(a){case",":return this[d]=c,this;case b:case"*":if(d!=c.length)throw"Vector Dimension mismatch.";var e,f=I.Global.Zero;for(e=0;e<d;e++)f=f.apply("+",this[e].apply("*",c[e]));return f;case"+":case"-":if(d!=c.length)throw"Vector Dimension mismatch.";var e,g=new Array(d);for(e=0;e<d;e++)g[e]=this[e].apply(a,c[e]);return s.Vector(g);case"/":case"^":default:throw"Vector operation not allowed."}},d.realimag=function(){var a=this.length,b=new Array(a),c=new Array(a),d;for(d=0;d<a;d++){var e=this[d].realimag();b[d]=e[0],c[d]=e[1]}return s.List.ComplexCartesian([s.Vector(b),s.Vector(c)])},s.Matrix=function(a,b,c){return a.__proto__=s.Matrix.prototype,a.rows=b,a.cols=c,a},d=s.Matrix.prototype=Object.create(s.prototype),d.constructor=s.Matrix,d.default=d["*"]=function(a){if(a.constructor===s.Matrix){if(a.rows!==this.cols)throw"Matrix dimensions do not match.";var b=[],c,d,e,f=0;for(c=0;c<this.rows;c++)for(d=0;d<a.cols;d++){var g=i.Zero;for(e=0;e<a.rows;e++)g=g["+"](a[e*a.cols+d]);b[f++]=g}return s.Matrix(b)}throw"Unknown type"},d.reduce=function(a){var b,c;for(c=0;c<this.rows;c++)for(b=0;b<c;b++){var d=this[b*this.cols+b];if(d===i.Zero)throw"Row swap!";var e=this[c*this.cols+b]["/"](d),f;for(f=b+1;f<this.cols;f++)this[c*this.cols+f]=this[c*this.cols+f]["-"](e["*"](this[b*this.cols+f]))}return this},s.Sum=function(b,c,d,e){this.x=b,this.f=e,this.a=c,this.b=d},d=s.Sum.prototype=Object.create(s.Symbol.Real.prototype),d.constructor=s.Sum,s.Sum.Real=function(b,c,d,e){this.x=b,this.f=e,this.a=c,this.b=d;if(!(this.x instanceof s.Symbol.Real))throw"Can only sum over reals in javascript"},d=s.Sum.Real.prototype=Object.create(s.Sum.prototype),d.constructor=s.Sum.Real,d.real=function(){return this},d.realimag=function(){return new s.List.ComplexCartesian([this,i.Zero])},d.s=function(a){if(a==="text/latex"){var b=this.f.s(a),c=this.a.s(a),d=this.b.s(a),e=this.x.s(a),f=b.s,g=b;return g=b.merge(c),g=b.merge(d),g.merge(e,"\\sum_{"+e.s+"="+c.s+"}^{"+d.s+"}"+f,n.precedence("*"))}if(a==="text/javascript"){var c=this.a.s(a),d=this.b.s(a);if(this.x instanceof s.Symbol.Real){var e=this.x.s(a),g=e.merge(c).merge(d),h=g.var(),i=g.var(),j=g.var(),k=g.var(),l=this.f.sub(this.x,new s.Symbol.Real(h)),b=l.s(a),m="var "+i+" = 0, "+h+", "+k+" = "+c.s+", "+j+" = "+d.s+";\nif("+j+" === Infinity) {\n\t"+j+" = 1000;\n}\nif (!("+j+" >= "+k+')) {\n\tthrow("Halting problem solved.")\n}\nfor('+h+" = "+k+"; "+h+" < "+j+"; "+h+"++) {\n\t"+i+" +="+b.s+";\n}\n";return g.merge(b,i,Infinity,m)}throw"Can only sum over reals in javascript"}if(a==="x-shader/x-fragment"){var c=this.a.s(a),d=this.b.s(a);if(this.x instanceof s.Symbol.Real){var e=this.x.s(a),g=e.merge(c).merge(d),h=g.var(),i=g.var(),l=this.f.sub(this.x,new s.Symbol.Real(h)),b=l.s(a),o="int("+c.s+")",p="int("+d.s+")",m="float "+i+" = 0.0;\nfor(float "+h+" = "+c.s+"; "+h+" < "+d.s+"; "+h+"+=1.0) {\n\t"+i+" += "+" + "+b.s+";\n}\n";return g.merge(b,i,Infinity,m)}throw"Can only sum over reals in GLSL"}},d["^"]=function(a){if(this.b_locked)throw"Sum was upper bounded twice!";return this.b=a,this.b_locked=!0,this},d.default=function(a){if(!this.b_locked)throw"Sum was not upper bounded!";if(this.f_locked)throw"Sum already defined";return this.f=a,this.f_locked=!0,this},s.List.prototype.expand=function(a){var b=1,c=-1,d=i.Zero,e=i.Zero;throw"Should be async, don't use this"},s.prototype.simplify=function(){return this},s.prototype.integrate=function(a){throw"Could not integrate expression."},s.prototype.integrateN=function(a,b){if(b===0)return this;if(b<=-1)return this.differentiateN(a,b);if(b>1)return this.integrate(a).integrateN(a,b-1);if(b===1)return this.integrate(a)};var A={"void":1,vec3:2,bool:6,"int":3,fp:4,vec2:5,vec4:7,mat2:10,mat3:11,mat4:12,func:20},B={Boolean:1,Number:2,String:3,"undefined":4,Object:5,Function:A.func,Array:7,ref:8},C={"text/javascript":function(a,c){function d(a){return"("+a+")"}function f(a){return a.p<=e?d(a.s):a.s}var e=a===b?n.precedence("default"):n.precedence(a);switch(a){case"=":return{s:f(c[0])+a+f(c[1]),t:B.assignment,p:e};case"&&":case"<":case">":case">=":case"<=":case"!==":case"!=":case"==":case"===":return{s:f(c[0])+a+f(c[1]),t:B.Boolean,p:e};case"+":case"-":case"/":case"*":case"?":case":":case",":case">>":case"<<":case"&":case"%":return{s:f(c[0])+a+f(c[1]),t:B.Number,p:e};case"_":if(c[0].t!==B.ref||c[1].t!==B.ref&&c[1].t!=B.Number)throw"Operator '_' does not exist in javaScript for those types.";return{s:f(c[0])+a+f(c[1]),t:B.ref,p:e};case"~":return{s:a+f(c[0]),t:B.Number,p:e};case"@-":case"@+":return{s:a.substring(1)+f(c[0]),t:B.Number,p:e};case"^":return{s:"Math.pow("+c[0].s+","+c[1].s+")",t:B.Number,p:e};case b:return c[0].t===B.Function?{s:c[0].s+"("+c[1].s+")",t:B.Number,p:e}:(e=n.precedence("*"),{s:f(c[0])+"*"+f(c[1]),t:B.Number,p:e});case"#":return{s:"function(x){return "+c[0].s+"}",t:B.Function,p:e};case"√":return{s:"Math.sqrt("+c[0].s+")",t:B.Number,p:e};case"!":return{s:"factorial("+c[1].s+")",t:B.Number,p:e};default:throw"Could not translate operator: '"+a+"' into javscript!"}},"x-shader/x-fragment":function(a,c){function d(a){return"("+a+")"}function f(a){return a.p<=e?d(a.s):a.s}var e=a===b?n.precedence("default"):n.precedence(a);switch(a){case"&&":case"||":if(c[0].t===c[1].t&&c[1].t===A.bool)return{s:f(c[0])+a+f(c[1]),t:A.bool,p:e};throw"Operands must also be boolean values";case"==":case"<":case">":case"<=":case">=":case"!=":if(c[0].t!==c[1].t)throw"The equality operators and assignment operator are only allowed if the two operands are same size and type.";return{s:f(c[0])+a+f(c[1]),t:A.bool,p:e};case":":if(c[0].t!==c[1].t)throw"Switching groups must be the same type";return{s:f(c[0])+a+f(c[1]),t:c[1].t,p:e};case"?":if(c[0].t!==A.bool)throw"Must be boolean type";return{s:f(c[0])+a+f(c[1]),t:c[1].t,p:e};case"+":case"-":case",":if(c[0].t!==c[1].t)throw"Types don't match: "+c[0].t+", "+c[1].t;return{s:f(c[0])+a+f(c[1]),t:A.fp,p:e};case"*":case"/":return{s:f(c[0])+a+f(c[1]),t:A.fp,p:e};case"_":throw"Write this later.";case"~":return{s:a+f(c[0]),t:B.Number,p:e};case"@-":case"@+":return{s:a.substring(1)+f(c[0]),t:A.fp,p:e};case"^":if(c[0].s==="2.718281828459045e+0")return{s:"exp("+c[1].s+")",t:A.fp,p:e};return{s:"pow("+c[0].s+","+c[1].s+")",t:A.fp,p:e};case b:return c[0].t===A.func?{s:c[0].s+"("+c[1].s+")",t:A.fp,p:e}:(e=n.precedence("*"),{s:f(c[0])+"*"+f(c[1]),t:A.fp,p:e});case"#":throw"Anonymous functions not supported.";case"√":return{s:"sqrt("+c[0].s+")",t:A.fp,p:e};case"!":return{s:"factorial("+c[0].s+")",t:A.fp,p:e};case"%":return{s:"mod("+c[0].s+","+c[1].s+")",t:A.fp,p:e};case"&":case"|":case"~":case">>":case"<<":throw"Reserved";default:throw"Could not translate operator: '"+a+"' into glsl!"}},"text/latex":function(a,c){function d(a){return"\\left("+a+"\\right)"}function f(b,c){return c?b.p<e?d(b.s):b.s:b.p===e?n.assoc(a)===!0?b.s:d(b.s):b.p<=e?d(b.s):b.s}var e=a===b?n.precedence("default"):n.precedence(a);switch(a){case"/":return{s:"\\frac{"+c[0].s+"}{"+c[1].s+"}",t:B.Number,p:e};case"^":case"_":return{s:f(c[0])+a+"{"+c[1].s+"}",t:B.ref,p:e};case b:if(c[0].s==="\\sqrt")return{s:"\\sqrt{"+c[1].s+"}",t:B.Number,p:e};if(c[0].s==="\\abs")return{s:"\\left|"+c[1].s+"\\right|",t:B.Number,p:e};return{s:f(c[0],1)+" "+f(c[1],1),t:B.Number,p:e};case"#":return{s:a+d(c[0].s),t:B.Fumber};case",":return{s:"\\left("+c.map(f).join(a)+"\\right)",t:B.Array,p:e}}if(a[0]=="@")return{s:a[1]+f(c[0]),t:B.Number,p:e};if(n.postfix(a))return{s:f(c[0])+a,t:B.Number,p:e};var g=this,h={"*":" ","∨":"\\vee ","&&":"\\wedge ","±":"\\pm ","∘":"\\circ "};return{s:c.map(f).join(h[a]||a),t:B.Number,p:e}}},D=n;d=E.prototype,d.var=function(){return"t"+(this.vars++).toString(36)},d.merge=function(a,b,c,d){this.s=b,d&&this.pre.push(d);var e;return this.pre.push.apply(this.pre,a.pre),this.vars+=a.vars,this.p=c,this},d.update=function(a,b,c){return this.p=b,c&&this.pre.push(c),this.s=a,this},d.compile=function(a){return Function(a,this.pre.join("\n")+"return "+this.s)},d.glslFunction=function(a,b,c){return a+" "+b+"("+c+"){\n"+this.pre.join("\n")+"return "+this.s+";\n}\n"},s.List.prototype.s=function(a){if(a==="text/latex")return s.List.Real.prototype.s.call(this,a);throw"Use real(), imag(), or abs(), or arg() first."},s.List.Real.prototype.s=function(a){function c(b){return a==="text/latex"?"\\left("+b+"\\right)":"("+b+")"}function l(a){return k>a.p?c(a.s):a.s}if(this.operator===b){if(this[0]instanceof s.Function){if(this[0]===i.abs){var d=this[1].s(a);if(a==="text/latex")return d.update("\\left|"+d.s+"\\right|",Infinity);var e=this[0].s(a);return d.update(e.s+"("+d.s+")",Infinity)}var e=this[0].s(a);if(this[1]instanceof s.Vector){var f=Array.prototype.map.call(this[1],function(b){return b.s(a)}),g,h=f.map(function(a){return a.s});this[0]===i.atan&&(h=h.reverse());var j=e.s;for(g=0;g<f.length;g++)e.merge(f[g]);return e.update(j+c(h),n.precedence("default"))}var d=this[1].s(a);return e.merge(d,e.s+c(d.s),n.precedence("default"))}this.operator="*"}var k=n.precedence(this.operator);if(this.operator==="^"){if(a==="x-shader/x-fragment"){if(this[0]===i.e){var d=this[1].s(a);return d.update("exp("+d.s+")")}if(this[1]instanceof s.Integer&&this[1].a<5&&this[1].a>-1){var e=this[0].s(a),m=n.precedence("*"),o=b,p;this[0]instanceof s.Symbol?p=e.s:(o="float "+p+" = "+e.s+";",p=e.var());var q=p,g;for(g=1;g<this[1].a;g++)q+="*"+p;return e.update("("+q+")",Infinity,o)}if(this[1]instanceof s.Integer&&this[1].a==-1){var e=this[0].s(a);return e.update("(1.0/("+e.s+"))")}if(this[1]instanceof s.Rational){this[1]=this[1].reduce();var r=this[1].a%2?!1:!0;if(r){var d=this[1].s(a),e=this[0].s(a);return e.merge(d,"pow("+e.s+","+d.s+")")}var d=this[1]["-"](i.One).s(a),e=this[0].s(a);return e.merge(d,"(("+e.s+") * pow("+e.s+","+d.s+"))")}if(this[0]instanceof s.NumericalReal){var d=this[1]["-"](i.One).s(a),e=this[0].s(a);return e.merge(d,"(("+e.s+") * pow("+e.s+","+d.s+"))")}var d=this[1]["-"](i.One).s(a),e=this[0].s(a);return e.merge(d,"(("+e.s+") * pow("+e.s+","+d.s+"))")}if(a==="text/javascript"){if(this[0]===i.e){var d=this[1].s(a);return d.update("Math.exp("+d.s+")")}if(this[1]instanceof s.Rational){var r=this[1].a%2?!1:!0;if(r){var d=this[1].s(a),e=this[0].s(a);return e.merge(d,"Math.pow("+e.s+","+d.s+")")}var d=this[1].s(a),e=this[0].s(a);return e.merge(d,"Math.pow("+e.s+","+d.s+")")}var d=this[1].s(a),e=this[0].s(a);return e.merge(d,"Math.pow("+e.s+","+d.s+")")}if(a==="text/latex"){var e=this[0].s(a),d=this[1].s(a);return e.merge(d,l(e)+"^"+"{"+d.s+"}")}}var e=this[0].s(a);if(this.operator[0]==="@")return e.update(this.operator[1]+l(e),k);var d=this[1].s(a);if(a==="text/latex"){if(this.operator==="/")return e.merge(d,"\\frac{"+e.s+"}{"+d.s+"}");if(this.operator==="*")return e.merge(d,l(e)+l(d),k)}else if(a==="x-shader/x-fragment"&&this.operator==="%")return e.merge(d,"mod("+l(e)+","+l(d)+")",k);return e.merge(d,l(e)+this.operator+l(d),k)},s.Statement.prototype.s=s.List.Real.prototype.s,s.Symbol.prototype.s=function(){return new E(this.symbol||"x_{free}")},s.NumericalReal.prototype.s=function(a){if(a==="x-shader/x-fragment"){var b=this.value.toExponential();return b.indexOf(".")===-1&&(b=b.replace("e",".e")),new E(b)}return new E(this.value.toString())},s.List.ComplexPolar.prototype.s=function(a){function d(a,b){return b>a.p?"\\left("+a.s+"\\right)":a.s}if(a!=="text/latex")throw"Exporting not supported for complex values.";var b=n.precedence("+"),c=n.precedence("*"),e=this[0].s(a),f=this[1].s(a);return e.merge(f,d(e,c)+""+"e^{i"+d(f,c))},s.List.ComplexCartesian.prototype.s=function(a){function c(a,b){return b>a.p?"\\left("+a.s+"\\right)":a.s}if(a!=="text/latex")throw"Exporting not supported for complex values.";var b=n.precedence("+"),d=this[0].s(a),e=this[1].s(a);return d.merge(e,c(d)+"+"+c(e,b)+"i",n.precedence("+"))},s.NumericalComplex.prototype.s=function(a){e("NumericalComplex.toTypedString????");if(a==="text/latex"){var b=this.realimag();if(this._real===0)return this._imag===1?new E("i"):this._imag===-1?new E("-i"):new E(b[1].s(n).s+"i");return this._imag===0?new E(b[0].s(n).s):this._imag===1?new E(b[0].s(n).s+" + i"):this._imag===-1?new E(b[0].s(n).s+" - i"):this._imag<0?new E(b[0].s(n).s+" + "+b[1].s(n).s+"i"):new E(b[0]+" + "+b[1].s(n).s+"i")}throw"Please use x.realimag()[0 /* or 1 */].toTypedString() to generate code."},s.Integer.prototype.s=function(a){return a==="x-shader/x-fragment"?new E(this.a.toString()+".0"):new E(this.a.toString())},s.Vector.prototype.s=function(a){var b=this.length,c="[",d="]";a==="x-shader/x-fragment"&&(c="vec"+this.length+"(",d=")");var e=this[0].s(a),f,g=[];for(f=0;f<b;f++){var h=this[f].s(a);g.push(h.s),e=e.merge(h)}return e.update(c+g.join(",")+d,Infinity)},s.True.s=function(a){return new E("true")},s.False.s=function(a){return new E("false")},s.prototype.compile=function(a){return this.s("text/javascript").compile(a)},s.prototype.glslFunction=function(a,b,c){return this.s("x-shader/x-fragment").glslFunction(a,b,c)},s.Numerical=s.Complex;var F=new s.Function({"default":function(a){if(a instanceof s.NumericalReal||a instanceof s.List.Real||a instanceof s.Symbol.Real)return new I.Expression.List.ComplexCartesian([i.sin.default(a),i.Zero]);throw new Error("Complex Sine Cartesian form not implemented yet.")}});i.sin=new s.Function({"default":function(a){return a instanceof s.NumericalReal?new s.NumericalReal(Math.sin(a.value)):a instanceof s.List.Real||a instanceof s.Symbol.Real?s.List.Real([i.sin,a]):s.List([i.sin,a])},realimag:function(){return F},"text/latex":"\\sin","text/javascript":"Math.sin","x-shader/x-fragment":"sin",title:"Sine Function",description:"See http://en.wikipedia.org/wiki/Trigonometric_functions#Sine.2C_cosine.2C_and_tangent",examples:["\\sin (\\pi)"],related:["cos","tan"]}),i.cos=new s.Function({"default":function(a){return a instanceof s.NumericalReal?new s.NumericalReal(Math.cos(a.value)):a instanceof s.List.Real||a instanceof s.Symbol.Real?s.List.Real([i.cos,a]):s.List([i.cos,a])},derivative:i.sin["@-"](),"text/latex":"\\cos","text/javascript":"Math.cos","x-shader/x-fragment":"cos",title:"Cosine Function",description:"Cosine Function desc",examples:["\\cos (\\pi)"],related:["sin","tan"]}),i.sin.derivative=i.cos,i.tan=new s.Function({symbolic:function(a){}}),i.log=new s.Function({"default":function(a,b){if(a instanceof s.Integer&&a.a===1)return i.Zero;if(a instanceof s.Integer&&a.a===0)return i.Infinity["@-"]();if(a instanceof s.NumericalReal){var c=a.value;if(c>0)return new s.NumericalReal(Math.log(c))}return b&&b.positive?s.List.Real([i.log,a]):s.List([i.log,a])},realimag:function(a){return H},"text/latex":"\\log","text/javascript":"Math.log","x-shader/x-fragment":"log",title:"Natural Logarithm",description:"Base e. See http://en.wikipedia.org/wiki/Natural_logarithm",examples:["\\log (ye^(2x))"],related:["exp","Log"]});var G=new s.Rational(1,2),H=new s.Function({"default":function(a){return(new s.List.ComplexCartesian([i.log.default(a.abs()),a.arg()]))["*"](G)}});H.__proto__=i.log,i.atan2=new s.Function({"default":function(a){if(a instanceof s.Vector)return a[0]instanceof s.NumericalReal&&a[1]instanceof s.NumericalReal?new s.NumericalReal(Math.atan2(a[0].value,a[1].value)):new s.List.Real([i.atan2,a]);throw"atan only takes vector arguments"},apply_realimag:function(a,b){return[s.List([i.atan2,b]),I.Global.Zero]},"text/latex":"\\tan^{-1}","text/javascript":"Math.atan2","x-shader/x-fragment":"atan",toTypedString:function(a){return{s:this[a],t:B.Function}},title:"Two argument arctangent function",description:"Arctan(y, x). Will equal arctan(y / x) except when x and y are both negative. See http://en.wikipedia.org/wiki/Atan2"}),i.atan=i.atan2,i.Gamma={"default":function(a){function b(a){var b,c,d,e,f,g=[57.15623566586292,-59.59796035547549,14.136097974741746,-0.4919138160976202,3399464998481189e-20,4652362892704858e-20,-0.00009837447530487956,.0001580887032249125,-0.00021026444172410488,.00021743961811521265,-0.0001643181065367639,8441822398385275e-20,-0.000026190838401581408,36899182659531625e-22];if(a<=0)throw"bad arg in gammln";e=c=a,d=c+5.2421875,d=(c+.5)*Math.log(d)-d,f=.9999999999999971;for(b=0;b<14;b++)f+=g[b]/++e;return d+Math.log(2.5066282746310007*f/c)}if(a instanceof s.Integer){var c=a.a;if(c<0)return i.ComplexInfinity;if(c<15){var d=1,e=0;for(e=1;e<c;e++)d*=e;return new s.Integer(d)}return s.List.Real([i.Gamma,a])}if(a instanceof s.NumericalReal){var c=a.value;return c===0?i.Infinity:c<0?new s.NumericalReal(-Math.PI/(c*Math.sin(Math.PI*c)*Math.exp(b(-c)))):new s.NumericalReal(Math.exp(b(c)))}return!(a instanceof s.NumericalComplex),s.List([i.Gamma,a])},"text/latex":"\\Gamma","text/javascript":"M.Global.Gamma.f",toTypedString:function(a){return{s:this[a],t:B.Function}},title:"Gamma Function",description:"See http://en.wikipedia.org/wiki/Gamma_function",examples:["\\Gamma (x)","x!"],related:["Log","LogGamma"]},i.Re={"default":function(a){return a.real()},apply_realimag:function(a,b){return[b.real(),i.Zero]},"text/latex":"\\Re"},i.Im={"default":function(a){return a.imag()},distributed_under_differentiation:!0,apply_realimag:function(a,b){return[b.imag(),i.Zero]},"text/latex":"\\Im"},s.List.Real.prototype.positive=function(){if(this.operator==="+")return this[0].positive&&this[1].positive&&this[0].positive()&&this[1].positive();if(this.operator==="*")return this[0]===this[1]?!0:this[0].positive&&this[1].positive&&this[0].positive()&&this[1].positive();if(this.operator==="^"&&this[1]instanceof s.Rational){var a=this[1].reduce();if(a.a%2===0)return!0}return!1},s.NumericalReal.prototype.positive=function(){return this.value>0},i.sqrt=new s.Function({"default":function(a){if(a instanceof s.NumericalReal){var c=a.value;return c<0?new s.List.ComplexCartesian([i.Zero,new s.NumericalReal(Math.sqrt(c))]):new s.NumericalReal(Math.sqrt(c))}return a instanceof s.List.Real?a.positive()?s.List.Real([i.sqrt,a]):s.List([i.sqrt,a]):a instanceof s.List.ComplexPolar?new s.List.ComplexPolar([a[0],a[1]["/"](new s.Integer(2))]):a instanceof s.List.ComplexCartesian?new s.List([i.sqrt,a]):s.List([i.sqrt,a])},apply_realimag:function(a,b){return b["^"](new s.Rational(1,2)).realimag()},"text/latex":"\\sqrt","text/javascript":"Math.sqrt","x-shader/x-fragment":"sqrt"
,toTypedString:function(a){return{s:this[a],t:B.Function}},title:"Sqrt Function",description:"See http://en.wikipedia.org/wiki/Square_Root",examples:["\\sqrt (x^4)"],related:["pow","abs","mod"]}),i.abs=new s.Function({"default":function(a){return a.abs()},"text/latex":"\\abs","text/javascript":"Math.abs","x-shader/x-fragment":"abs",titie:"Absolute Value Function",description:"Abs",examples:["\\abs (-3)","\\abs (i+3)"],related:["arg","tan"]}),i.abs.derivative=function(){var a=new s.Symbol.Real,b=a["/"](a.abs());return new s.Function.Symbolic(b,[a])}(),i.arg={"default":function(a){return console.warn("ARG IS FOR USER INPUT ONLY. USE .arg()"),a.arg()},"text/latex":"\\arg","text/javascript":"Math.arg_real",toTypedString:function(a){return{s:this[a],t:B.Function}},titie:"Arg Function",description:"Arg",examples:["\\arg (-3)","\\arg (3)","\\arg(3+2i)"],related:["abs"]},i.e=new s.NumericalReal(Math.E,0),i.e.title="e",i.e.description="The transcendental number that is the base of the natural logarithm, approximately equal to 2.71828.",i.e.s=function(a){return a==="text/javascript"?new E("Math.E"):a=="text/latex"?new E("e"):new E("2.718281828459045")},i.pi=new s.NumericalReal(Math.PI,0),i.pi.title="Pi",i.pi.description="",i.pi.s=function(a){return a==="text/javascript"?new E("Math.PI"):a==="text/latex"?new E("\\pi"):new E("3.141592653589793")},i.tau=i.pi["*"](new s.Integer(2)),i.Infinity=new s.NumericalReal(Infinity,0),i.Infinity.title="Infinity",i.Infinity.description="",i.infty=i.Infinity,i.Zero=new s.Integer(0),i.Zero.title="Zero",i.Zero.description="Additive Identity",i.Zero["*"]=function(a){return i.Zero},i.Zero["+"]=function(a){return a},i.Zero["@-"]=function(a){return this},i.Zero["-"]=function(a){return a["@-"]()},i.One=new s.Integer(1),i.One.title="One",i.One.description="Multiplicative Identity",i.One["*"]=function(a){return a},i.log.derivative=new s.Function.Symbolic(i.One["/"](new s.Symbol.Real)),i.i=new s.List.ComplexCartesian([i.Zero,i.One]),i.i.title="Imaginary Unit",i.i.description="A number which satisfies the property <m>i^2 = -1</m>.",i.i.realimag=function(){return s.List.ComplexCartesian([i.Zero,i.One])},i.i["*[TODO]"]=function(a){},i.d=new s.Function({"default":function(a){return new x(a)}}),i.d["/"]=function(a){if(a instanceof x){if(a.x instanceof s.Symbol)return new z(a.x);if(a.x instanceof s.Vector)return s.Vector(Array.prototype.map.call(a.x,function(a){return new z(a)}));throw"Confusing infitesimal division"}throw"Dividing d by some large number."},i["undefined"]={s:function(a){if(a==="text/javascript")return new E("undefined");if(a==="x-shader/x-fragment")return new E("(1.0/0.0)")},differentiate:function(){return this},"*":function(){return this},"+":function(){return this},"-":function(){return this},"/":function(){return this},"^":function(){return this},"@-":function(){return this}},i.sum=new s.Function({"default":function(a){throw"Sum not properly constructed yet."}}),i.sum._=function(a){var b=a[0],c=a[1];return new s.Sum.Real(b,c)},I.toString=function(){return"function M() {\n    /*!\n     *  Math JavaScript Library v3.0.0\n     *  https://github.com/aantthony/javascript-cas\n     *  \n     *  Copyright 2010 Anthony Foster. All rights reserved.\n     */\n    [awesome code]\n}"},I.Context=r,I.Expression=s,I.Global=i;var J={};I.register=function(a,b){if(s.prototype[a])throw"Method ."+a+" is already in use!";J[a]=b},I.load=function(a,b){J[a](I,s,b),delete J[a]},typeof module!="undefined"?module.exports=I:window.M=I,console.log("Load time:",new Date-f,"ms")})();