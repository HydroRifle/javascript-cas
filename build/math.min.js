/**
 *  Math JavaScript Library v3.0.0
 *  https://github.com/aantthony/javascript-cas
 *  
 * Copyright 2010 Anthony Foster. All rights reserved.
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */(function(b){function d(a){var b=(new Error(a)).stack;if(!b)return console.warn("Deprecated: "+a);console.warn(b.replace(/^Error\: /,"Deprecated: "))}function g(a){function e(a,b,e){var f=[b,d++,e];if(typeof a=="object")for(var g=0;g<a.length;g++)c[a[g]]=f;else c[a]=f}var c={},d=0;a.forEach(function(a){e(a[0],a[1]||k,a[2]===b?2:a[2])}),this.operators=c,g.build.call(this)}function o(){}function r(a,b){var c=m.parse(a,b);return c}function s(a,b){this.A=a||[],this.m=b||[]}function t(a){return a.__proto__=t.prototype,a}function u(a){this.x=a}function v(a){this.x=a}function B(a,b){this.pre=[]||b,this.s=a,this.vars=0,this.p=Infinity}function E(a,b){var c=r(a,b||E.Global);return c}"use strict";var f=new Date;g.prototype.precedence=function(a){if(!this.operators[a])throw"Precedence of "+a+" not known!";return this.operators[a][1]},g.prototype.postfix=function(a){var b=this.operators[a];return b[0]===0&&b[2]===1},g.prototype.unary=function(a){var b=["+","-","±"];return b.indexOf(a)!=-1?"@"+a:!1},g.prototype.assoc=function(a){return this.operators[a][1]===!0},g.prototype.Number=function(a){var b={0:h.Zero,1:h.One};if(b[a])return b[a];if(/^[\d]+$/.test(a))return new r.Integer(Number(a));if(/^[\d]*\.[\d]+$/.test(a)){var c=a.indexOf("."),d=a.length-c-1,e=Math.pow(10,d),f=Number(a.replace(".",""));return(new r.Rational(f,e)).reduce()}return b[a]||new r.NumericalReal(Number(a))},g.build=function(){function a(a){var d,e=a.length;while((d=a.indexOf("\\begin"))!=-1){var f=a.indexOf("}",d+7),g=a.substring(d+7,f),h="\\end{"+g+"}",i=a.indexOf(h,f),j=a.substring(f+1,i);switch(g){case"matrix":j=j.replace(/\\\:/g,",").replace(/\\\\/g,";"),a=a.split(""),a[d]="[",a.splice(i,h.length-1),a[i]="]",a.splice(f+1,i-f-1,j),a.splice(d+1,f+1-d-1),a=a.join("");break;default:throw new SyntaxError("Latex \\begin{"+g+"} block not understood.")}}while((d=a.indexOf("\\text"))!==-1){var f=a.indexOf("}",d+6),k=a.substring(d+6,f);a=a.split(""),a.splice(d,f-d+1,"\\"+k),a=a.join("")}while((d=a.indexOf("\\frac"))!==-1){var f,l=!1,m=0;for(f=d+5;f<e;f++)if(a[f]==="{")m++;else if(a[f]==="}"){m--;if(!m){l=!0;break}}if(!l)throw new SyntaxError(msg.latexParse);l=!1;if(a[f+1]!=="{")throw new SyntaxError("Unexpected '"+a[f+1]+"' between \\frac operands");var n=f+1,o;for(o=n;o<e;o++)if(a[o]==="{")m++;else if(a[o]==="}"){m--;if(!m){l=!0;break}}if(!l)throw new SyntaxError(msg.latexParse);a=a.split(""),a[d+5]="((",a[f]=")",a[n]="(",a[o]="))",a.splice(n,0,"/"),a.splice(d,5),a=a.join("")}return a=a.replace(/\^([^\{\(])/g,"^{$1}"),a=a.replace(/\\left\|/g,"\\abs("),a=a.replace(/\\right\|/g,")"),a=a.replace(/\\\:/g," "),a=a.replace(/\\([a-z\%]+)/g,function(a,d){var e=c[d];return" "+(e!==b?e:"\\"+d)}),a=a.replace(/[\[\{]/g,"("),a=a.replace(/[\]\}]/g,")"),a}var c={cdot:"*",vee:"∨",wedge:"&&",neg:"¬",left:"",right:"",pm:"±",circ:"∘",div:"/","%":"%",gt:">","left|":"\\abs(","right|":")",times:"*",":":"","left(":"(","right)":")","left[":"[","right]":"]",ge:">=",lt:"<",le:"<=",sim:"~",frac:"",backslash:"\\"},d=this.operators,e={string:1,number:2,operator:3,comment:4,parenopen:5,parenclose:6,symbol:7},f="1234567890.",g=["+","-","@","*","/","^","++","=","!",",","@-","@+","_","#","<","<=",">",">=","%"],h="([{",j="}'])",k=g.join("")+h+j+f,l="default",n=[function(){throw"NONE"},function(b){return!1},function(b){return f.indexOf(b[b.length-1])!==-1},function(b){return g.indexOf(b)!==-1},function(b){return b[b.length-1]===" "},function(b){return b.length==1&&h.indexOf(b)!=-1},function(b){return b.length==1&&j.indexOf(b)!=-1},function(b){return/^[A-Za-z]$/.test(b[b.length-1])},function(b){throw new SyntaxError("Invalid character: '"+b+"'")}],n=[function(){throw"NONE"},function(b){return!1},function(b){return f.indexOf(b[b.length-1])!==-1},function(b){return g.indexOf(b)!==-1},function(b){return b[b.length-1]===" "},function(b){return b.length==1&&h.indexOf(b)!=-1},function(b){return b.length==1&&j.indexOf(b)!=-1},function(b){return b[0]==="\\"?b.length===1||/^[A-Za-z]$/.test(b[b.length-1]):b.length===1&&/^[A-Za-z]$/.test(b[0])},function(b){throw new SyntaxError("Invalid character: '"+b+"'")}],o=n.map(function(a){return a.name});this.parse=function(c,f){function o(a){var b=k[a];return delete k[a],b}function p(a){if(a.t===e.number||a.t===e.symbol)j.push(a.v);else{var b=d[a.v][2];if(j.length<b)throw new SyntaxError("The '"+a.v+"' operator requires exactly "+b+" operands, whereas only "+j.length+" "+(j.length===1?"was ":"were ")+"supplied, namely "+j.toString());var c=j.splice(-b,b),f=c[0][a.v](c.splice(1)[0]);j.push(f)}}function q(a){a.t===e.symbol&&(a.v[0]==="\\"&&(a.v=a.v.substring(1)),d[a.v]?a.t=e.operator:a.v==="false"?a.v=!1:a.v==="true"?a.v=!0:a.v==="Infinity"?a.v=Infinity:typeof a.v=="string"&&(f[a.v]?a.v=f[a.v]:k[a.v]?a.v=k[a.v]:a.v=k[a.v]=new r.Symbol.Real(a.v)));if(a.t===e.number||a.t===e.symbol)a.t==e.number&&(a.v=m.Number(a.v)),p(a);if(a.t===e.operator){var b=a,c=d[b.v][1],g=d[b.v][0],j;while(h.length&&(j=h[h.length-1]).t===e.operator&&(g==i&&c<=d[j.v][1]||g!=i&&c<d[j.v][1]))p(h.pop());h.push(b)}a.t===e.parenopen&&h.push(a);if(a.t===e.parenclose){while(h[h.length-1].t!==e.parenopen){if(!h.length)throw new SyntaxError(msg.parenMismatch);p(h.pop())}if(h.pop().t!==e.parenopen)throw"Pop the left parenthesis from the stack: Not found ! "}}function s(a,b){if(b===e.comment)return;b!==e.operator&&b!==e.parenclose?g!==e.parenopen&&g!==e.operator&&s(l,e.operator):b===e.operator&&!m.postfix(a)&&(g===e.parenopen||g===e.operator)&&m.unary(a)&&(a=m.unary(a)),q({v:a,t:b}),g=b}if(c==="")return b;c=a(c);var g=e.parenopen,h=[],j=[],k={},t=0,u=c.length,v=c[0],w;for(w=1;w<8;w++)if(n[w](v))break;for(t=1;t<u;t++){var x=c[t],y=v+x;if(n[w](y))v=y;else{var z;for(z=1;z<8;z++)if(n[z](x))break;s(v,w),w=z,v=x}}s(v,w);while(h.length){var A,B=(A=h.pop()).t;if(B===e.parenopen||B===e.parenclose)throw"There are mismatched parentheses.";p(A)}if(j.length!==1)throw"Stack not the right size!";return j[0].unbound=k,j[0]}};var h={},i,j,k=i=0,l=j=1,m=new g([[";"],[","],[["=","+=","-=","*=","/=","%=","&=","^=","|="],l],[["?",":"],l,2],[["∨"]],[["&&"]],[["|"]],[["??????"]],[["&"]],[["==","≠","!==","==="]],[["<","<=",">",">="],k],[[">>","<<"]],["±",l,2],[["+"],!0],[["-"],k],[["∫","∑"],l,1],[["*","%"],l],[["@+","@-","@±"],l,1],[["¬"],k,1],["default",l,2],["∘",l,2],[["/"]],[["^"]],["!",k,1],[["~"],l,1],[["++","++",".","->"],k,1],[["::"]],[["_"],k,2],["var",l,1],["break",l,0],["throw",l,1],["'",k,1],["√",l,1],["#",l,1]]),n=new g([[";"],[","],[["=","+="]]]);o.prototype=Object.create(h),o.prototype.reset=function(){this.splice(0)},o.prototype.impliesExpression=function(a){return!1},o.prototype.learn=function(a){this.equations.push(a)},r.prototype.valueOf=null,r.prototype.identity=function(){return d("Slow"),this},r.prototype.toString=null,r.prototype.imageURL=function(){return"http://latex.codecogs.com/gif.latex?"+encodeURIComponent(this.s("text/latex").s)},r.prototype.image=function(){var a=new Image;return a.src=this.imageURL(),a},r.prototype.sub=function(){return this},r.prototype.lim=function(a,b){return this.sub(a,b)},r.prototype[","]=function(a){return r.Vector([this,a])},r.prototype["="]=function(a){return new r.Statement(this,a,"=")},r.prototype["!="]=function(a){return new r.Statement(this,a,"!=")},r.prototype[">"]=function(a){return new r.Statement(this,a,">")},r.prototype[">="]=function(a){return new r.Statement(this,a,">=")},r.prototype["<"]=function(a){return new r.Statement(this,a,"<")},r.prototype["<="]=function(a){return new r.Statement(this,a,"<=")},r.List=function(a,b){return a.__proto__=r.List.prototype,a.operator=b,a},r.List.prototype=Object.create(r.prototype),r.List.prototype.constructor=r.List,r.List.prototype.sub=function(a,b){var c=this[0].sub(a,b);if(this.length===1)return c[this.operator]();var d=this[1].sub(a,b);return c[this.operator||"default"](d)},r.prototype["*"]=function(a){return a===h.Zero?a:a===h.One?this:new r.List([this,a],"*")},r.prototype.default=function(a){return this["*"](a)},r.List.prototype["@-"]=function(){return this.operator==="@-"?this[0]:new r.List([this],"@-")},r.prototype["/"]=function(a){return new r.List([this,a],"/")},r.prototype["+"]=function(a){return new r.List([this,a],"+")},r.prototype["-"]=function(a){return new r.List([this,a],"-")},r.prototype["^"]=function(a){return new r.List([this,a],"^")},r.prototype["%"]=function(a){return new r.List([this,a],"%")},s.prototype.add=function(a){var b=this.A.indexOf(a);if(b===-1){var c=this.length;this.A[c]=a,this.m[c]=1}else this.m[b]++;return this},s.prototype.remove=function(a){var b=this.A.indexOf(a);return this.m[b]--,this},s.prototype.intersect=function(a){throw"What is multiset intersection?"},s.prototype.map=function(a){return s(Array.prototype.map.call(this.A,a),this.m)},s.fromArray=function(a){throw"NYI";var b,c},t.prototype.intersect=function(a){var b,c=this.length,d,e=a.length,f=new t([]);for(b=0;b<c;b++)for(d=0;d<e;d++){var g=this[b],i=a[d];if(g===i){f[f.length]=g;break}var j=g["-"](i);if(j===h.Zero){f[f.length]=g;break}}return g},t.prototype.union=function(a){return t(Array.prototype.concat.call(this,a))},t.prototype.remove=function(a){var b=this.indexOf(a);return this[b]=this[this.length-1],this.length--,this},t.prototype.add=function(a){return this.indexOf(a)===-1&&(this[this.length]=a),this},t.prototype.map=function(a){return t(Array.prototype.map.call(this,a))},r.Statement=function(a,b,c){var d=[a,b];return d.operator=c,d.__proto__=r.Statement.prototype,d},r.Statement.prototype=Object.create(r.prototype),r.Statement.prototype.constructor=r.Statement,r.Statement.prototype["="]=function(){},r.Statement.prototype["<"]=function(){},r.Statement.prototype.solve=function(a){var b=this.a["-"](this.b);return b.roots(a)},r.Constant=function(){throw new Error("Expression.Constant created directly")},r.Constant.prototype=Object.create(r.prototype),r.Constant.prototype.simplify=function(){return this},r.Constant.prototype.differentiate=function(){return E.Global.Zero},r.Constant.prototype.default=function(a){return this["*"](a)},r.Symbol=function(b){this.symbol=b},r.Symbol.prototype=Object.create(r.prototype),r.Symbol.prototype.constructor=r.Symbol,r.Symbol.prototype.differentiate=function(a){return this===a?h.One:h.Zero},r.Symbol.prototype.integrate=function(a){return this===a?(new r.NumericalReal(.5,0))["*"](a["^"](new r.NumericalReal(2,0))):this["*"](a)},r.Symbol.prototype.sub=function(a,b){return this===a?b:this},r.Symbol.Real=function(b){this.symbol=b},r.Symbol.Real.prototype=Object.create(r.Symbol.prototype),r.Symbol.Real.prototype.realimag=function(){return r.List.ComplexCartesian([this,h.Zero])},r.Symbol.Real.prototype.real=function(){return this},r.Symbol.Real.prototype.imag=function(){return h.Zero},r.Symbol.Real.prototype.polar=function(){return r.List.ComplexPolar([r.List.Real([h.abs,this]),r.List.Real([h.arg,this])])},r.Symbol.Real.prototype.abs=function(){return r.List.Real([h.abs,this])},r.Symbol.Real.prototype.arg=function(){return r.List.Real([h.arg,this])},r.Symbol.Real.prototype["+"]=function(a){return a==h.Zero?this:a instanceof r.NumericalReal?new r.List.Real([this,a],"+"):a instanceof r.Symbol.Real?new r.List.Real([this,a],"+"):a instanceof r.Symbol?new r.List([this,a],"+"):a["+"](this)},r.Symbol.Real.prototype["-"]=function(a){return this===a?h.Zero:a instanceof r.Symbol.Real?new r.List.Real([this,a],"-"):a instanceof r.List.Real?a.operator==="@-"?new r.List.Real([this,a[0]],"+"):new r.List.Real([this,a],"-"):a instanceof r.Symbol?new r.List([this,a],"-"):a["@-"]()["+"](this)},r.Symbol.Real.prototype["@+"]=function(a){return r.List.Real([this],"@+")},r.Symbol.Real.prototype["@-"]=function(a){return r.List.Real([this],"@-")},r.Symbol.Real.prototype["*"]=function(a){return a instanceof r.Rational&&a.a===a.b?this:a instanceof r.Rational&&a.a===0?h.Zero:a instanceof r.Symbol.Real?new r.List.Real([this,a],"*"):a instanceof r.List.Real?a["*"](this):a instanceof r.Symbol?new r.List([this,a],"*"):a instanceof r.NumericalReal?new r.List.Real([a,this],"*"):a instanceof r.NumericalComplex?new r.List.Real([this,a],"*"):a instanceof r.List.ComplexCartesian?a["*"](this):a["*"](this)},r.Symbol.Real.prototype.default=r.Symbol.Real.prototype["*"],r.Symbol.Real.prototype["/"]=function(a){if(a instanceof r.Rational&&a.a===a.b)return this;if(a instanceof r.Rational&&a.a===0)throw"Division by zero";return r.List.Real([this,a],"/")},r.Symbol.Real.prototype["^"]=function(a){if(a instanceof r.Rational&&a.a===0)return h.One;if(a instanceof r.Rational&&a.a===a.b)return this;if(a instanceof r.Integer)return r.List.Real([this,a],"^");if(a instanceof r.Rational){var b=a.reduce();if(b.a%2===0)return r.List.Real([this,a],"^")}return r.List([this,a],"^")},r.Symbol.Real.prototype.apply=function(a,c){throw"Real.apply"},r.Symbol.Real.prototype.constructor=r.Symbol.Real,r.Function=function(a){this.default=a.default,this["text/latex"]=a["text/latex"],this["x-shader/x-fragment"]=a["x-shader/x-fragment"],this["text/javascript"]=a["text/javascript"],this.derivative=a.derivative,this.realimag=a.realimag},r.Function.prototype=Object.create(r.prototype),r.Function.prototype.constructor=r.Function,r.Function.prototype.default=function(a){return},r.Function.prototype.differentiate=function(){if(this.derivative)return this.derivative;throw"Function has no derivative defined."},r.Function.prototype.s=function(a){if(this[a])return new B(this[a]);throw"Could not compile function into "+a},r.Function.Symbolic=function(b,c){this.expr=b,this.symbols=c},r.Function.Symbolic.prototype=Object.create(r.Function.prototype),r.Function.Symbolic.prototype.constructor=r.Function.Symbolic,r.Function.Symbolic.prototype.default=function(a){a.constructor!==r.Vector&&(a=r.Vector([a]));var b=this.expr,c,d=this.symbols.length;if(d!==a.length)throw"Invalid domain. Element of F^"+d+" expected.";for(c=0;c<d;c++)b=b.sub(this.symbols[c],a[c]);return b},r.Function.prototype["+"]=function(a){var b=new r.Symbol;return new r.Function.Symbolic(this.default(b)["+"](a),[b])},r.Function.prototype["@-"]=function(a){var b=new r.Symbol;return new r.Function.Symbolic(this.default(b)["@-"](),[b])},r.NumericalComplex=function(a,b){this._real=a,this._imag=b},r.NumericalComplex.prototype=Object.create(r.Constant.prototype),r.NumericalComplex.prototype.real=function(){return new r.NumericalReal(this._real)},r.NumericalComplex.prototype.imag=function(){return new r.NumericalReal(this._imag)},r.NumericalComplex.prototype.realimag=function(){return r.List.ComplexCartesian([new r.NumericalReal(this._real),new r.NumericalReal(this._imag)])},r.NumericalComplex.prototype.conjugate=function(){return new r.NumericalComplex(this._real,-this._imag)},r.NumericalComplex.prototype["+"]=function(a){if(this._real===0&&this._imag===0)return a;if(a instanceof r.NumericalComplex)return new r.NumericalComplex(this._real+a._real,this._imag+a._imag);if(a instanceof r.NumericalReal)return new r.NumericalComplex(this._real+a.value,this._imag);if(a.constructor===r.List.ComplexCartesian)return a["+"](this);if(a.constructor===r.List.ComplexPolar)return a["+"](this);if(a.constructor===r.List.Real)return a["+"](this);if(a.constructor===r.Symbol.Real)return a["+"](this);if(a.constructor===r.List)return a["+"](this);throw"Unknown Type for NumericalComplex +"},r.NumericalComplex.prototype["-"]=function(a){if(this._real===0&&this._imag===0)return a["@-"]();if(a instanceof r.NumericalComplex)return new r.NumericalComplex(this._real-a._real,this._imag-a._imag);if(a.constructor===r.NumericalReal)return new r.NumericalComplex(this._real-a.value,this._imag);if(a.constructor===r.List.ComplexCartesian)return a["@-"]()["+"](this);if(a.constructor===r.List.ComplexPolar)return a["@-"]()["+"](this);if(a.constructor===r.List.Real)return a["@-"]()["+"](this);if(a.constructor===r.Symbol.Real)return a["@-"]()["+"](this);if(a.constructor===r.List)return a["@-"]()["+"](this);throw"Unknown Type for NumericalComplex -"},r.NumericalComplex.prototype["*"]=function(a){if(this._imag===0){if(this._real===0)return h.Zero;if(this._real===1)return a}if(a.constructor===this.constructor)return new r.NumericalComplex(this._real*a._real-this._imag*a._imag,this._real*a._imag+this._imag*a._real);if(a.constructor===r.NumericalReal)return new r.NumericalComplex(this._real*a.value,this._imag*a.value);if(a.constructor===r.List.ComplexCartesian)return a["*"](this);if(a.constructor===r.List.ComplexPolar)return a["*"](this);if(a.constructor===r.List.Real)return a["*"](this);if(a.constructor===r.Symbol.Real)return a["*"](this);if(a.constructor===r.List)return a["*"](this);throw"Unknown Type for NumericalComplex *"},r.NumericalComplex.prototype["/"]=function(a){if(this._imag===0&&this._real===0)return h.Zero;if(a.constructor===this.constructor){var b=a._real*a._real+a._imag*a._imag;return new r.NumericalComplex((this._real*a._real+this._imag*a._imag)/b,(this._imag*a._real-this._real*a._imag)/b)}if(a.constructor===r.NumericalReal)return new r.NumericalComplex(this._real/a.value,this._imag/a.value);if(a.constructor===r.List.ComplexCartesian)return this.realimag()["/"](a);if(a.constructor===r.List.ComplexPolar)return this.polar()["/"](a);if(a.constructor===r.List.Real)return r.List([this,a],"/");if(a.constructor===r.Symbol.Real)return r.List([this,a],"/");if(a.constructor===r.List)return r.List([this,a],"/");throw"Unknown Type for NumericalComplex /"},r.NumericalComplex.prototype["!"]=function(){return h.Gamma.default(this)},function(){return;var a}(),r.NumericalComplex.prototype.constructor=r.NumericalComplex,r.prototype.conjugate=function(){throw"Conjugate"},r.List.prototype.conjugate=function(){var a,b=this.length,c=new Array(b);for(a=0;a<b;a++)c[a]=this[a].conjugate();return r.List(c,this.operator)},r.NumericalReal=function(b){this.value=b},r.NumericalReal.prototype=Object.create(r.NumericalComplex.prototype),r.NumericalReal.prototype.constructor=r.NumericalReal,r.NumericalReal.prototype.__defineGetter__("_real",function(){return this.value}),r.NumericalReal.prototype._imag=0,r.NumericalReal.prototype.real=function(){return this},r.NumericalReal.prototype.imag=function(){return h.Zero},r.NumericalReal.prototype.realimag=function(){return r.List.ComplexCartesian([this,h.Zero])},r.NumericalReal.prototype.conjugate=function(){return this},r.NumericalReal.prototype["+"]=function(a){return this.value===0?a:a instanceof r.NumericalReal?new r.NumericalReal(this.value+a.value):a["+"](this)},r.NumericalReal.prototype["@-"]=function(a){return new r.NumericalReal(-this.value)},r.NumericalReal.prototype["-"]=function(a){return this.value===0?a:a instanceof r.NumericalReal?new r.NumericalReal(this.value-a.value):a["@-"]()["+"](this)},r.NumericalReal.prototype["%"]=function(a){var b="The modular arithmetic operator '%' is not defined for non-real numbers.";if(this.value===0)return h.Zero;if(a.constructor===this.constructor)return new r.NumericalReal(this.value%a.value);if(a.constructor===r.List.Real)return r.List.Real([this,a],"%");if(a.constructor===r.Symbol.Real)return r.List.Real([this,a],"%");throw a.constructor===r.List?"Not sure about this...":a.constructor===r.NumericalComplex?new TypeError(b):a.constructor===r.List.ComplexCartesian?new TypeError(b):a.constructor===r.List.ComplexPolar?new TypeError(b):"Unknown Type for NumericalReal %"},r.NumericalReal.prototype["*"]=function(a){return a instanceof r.NumericalReal?new r.NumericalReal(this.value*a.value):a["*"](this)},r.NumericalReal.prototype["/"]=function(a){if(this.value===0)return h.Zero;if(a instanceof r.NumericalReal){if(a.value===0)throw"Division by zero not allowed!";return new r.NumericalReal(this.value/a.value)}if(a.constructor===r.NumericalComplex){var b=a._real*a._real+a._imag*a._imag;return new r.Complex(this.value*a._real/b,-this.value*a._imag/b)}if(a instanceof r.List.ComplexCartesian){var c=r.List.ComplexCartesian([a[0],a[1]["@-"]()]),d=r.NumericalReal(2);return c["*"](this)["/"](a[0]["^"](d)["+"](a[1]["^"](d)))}if(!(a instanceof r.List.ComplexPolar)){if(a instanceof r.List.Real)return r.List.Real([this,a],"/");if(a instanceof r.Symbol.Real)return r.List.Real([this,a],"/");if(a instanceof r.List)return r.List([this,a],"/");throw console.log("Unknown type: ",this,a),"Unknown Type for NumericalReal /"}},r.NumericalReal.prototype["^"]=function(a){if(this.value===0)return h.Zero;if(this.value===1)return h.One;if(a===h.Zero)return h.One;if(a===h.One)return this;if(a instanceof r.Integer)return new r.NumericalReal(Math.pow(this.value,a.a));if(a instanceof r.NumericalReal){if(this.value>0)return new r.NumericalReal(Math.pow(this.value,a.value));var b=Math.pow(-this.value,a.value),c=Math.PI*a.value;return new r.List.ComplexPolar([new r.NumericalReal(b),new r.NumericalReal(c)])}if(a.constructor===r.NumericalComplex){var d=this.value,e=a._real,f=a._imag;console.error("Bad implementation ( num ^ complex)");var g=.5*Math.log(d*d),i=g*f,j=Math.exp(g*e);return new r.NumericalComplex(j*Math.cos(i),j*Math.sin(i))}if(a.constructor===r.List.ComplexCartesian)return r.List([this,a],"^");if(a.constructor===r.List.ComplexPolar)return r.List([this,a],"^");if(a.constructor===r.List.Real)return this.value>0?r.List.Real([this,a],"^"):r.List([this,a],"^");if(a.constructor===r.Symbol.Real)return this.value>0?r.List.Real([this,a],"^"):r.List([this,a],"^");if(a.constructor===r.List)return r.List([this,a],"^");throw console.error("Unknown Type for NumericalReal ^",a,a instanceof r.NumericalReal)},r.NumericalReal.prototype.apply=function(a,c){switch(a){case",":return r.Vector([this,c]);case"^":if(this.value===0)return h.Zero;break;case"+":if(this.value===0)return c;break;case"-":if(this.value===0)return c.apply("@-");break;case b:case"*":if(this.value===1)return c;case"/":if(this.value===0)return h.Zero}if(c===b)switch(a){case"@+":return this;case"@-":return new r.NumericalReal(-this.value);case"++":case"--":throw new TypeError("Postfix "+a+" operator applied to value that is not a reference.");case"+=":case"-=":case"*=":case"/=":throw new ReferenceError("Left side of assignment is not a reference.");case"!":return h.Gamma.apply(b,new r.NumericalReal(this.value+1))}else if(c.constructor===this.constructor)switch(a){case"*":case b:return new r.NumericalReal(this.value*c.value);case"+":return new r.NumericalReal(this.value+c.value);case"-":return new r.NumericalReal(this.value-c.value);case"/":return new r.NumericalReal(this.value/c.value);case"^":if(this.value>0)return new r.NumericalReal(Math.pow(this.value,c.value));var d=Math.pow(-this.value,c.value),e=Math.PI*c.value;return new r.Complex(d*Math.cos(e),d*Math.sin(e));default:}else if(c.constructor===r.Complex)switch(a){case"*":case b:return new r.Complex(this.value*c._real,this.value*c._imag);case"+":return new r.Complex(this.value+c._real,c._imag);case"-":return new r.Complex(this.value-c._real,-c._imag);case"/":var f=c._real*c._real+c._imag*c._imag;return new r.Complex(this.value*c._real/f,-this.value*c._imag/f);case"^":var g=this.value,i=c._real,j=c._imag;console.error("Bad implementation ( num ^ complex)");var k=.5*Math.log(g*g),l=k*j,m=Math.exp(k*i);return new r.Complex(m*Math.cos(l),m*Math.sin(l));default:}else if(c.constructor===r.List.ComplexCartesian)switch(a){case"+":case"-":return r.List.ComplexCartesian([c[0].apply(a,this),c[1]]);case b:a="*";case"*":case"/":return r.List.ComplexCartesian([c[0].apply(a,this),c[1].apply(a,this)]);case"^":return console.warn("ineffecient: NR ^ CL"),this.realimag().apply(a,c)}else if(c.constructor===r.List.ComplexPolar)switch(a){case"+":case"-":case"^":return r.List([this,c],a);case b:a="*";case"*":return r.List.ComplexPolar([c[0].apply(a,this),c[1]]);case"/":return r.List.ComplexPolar([c[0].apply(a,this),c[1]])}else if(c.constructor===r.List.Real)switch(a){case b:a="*";case"*":case"+":case"-":case"/":return r.List.Real([this,c],a);case"^":if(this.value===0)throw"N(0) ^ x";return this.value>0?r.List.Real([this,c],a):r.List.ComplexPolar([(new r.Numerical(-this.value)).apply("^",c),h.pi.apply("*",c)])}else if(c.constructor===r.Symbol.Real)switch(a){case b:a="*";case"*":case"+":case"-":case"/":return r.List.Real([this,c],a);case"^":if(this.value===0)throw"N(0) ^ x";return this.value>0?r.List.Real([this,c],a):r.List.ComplexPolar([r.List.Real([new r.NumericalReal(-this.value),c],"^"),h.pi.apply("*",c)])}throw"?? - real"},r.Rational=function(b,c){this.a=b,this.b=c},r.Rational.prototype=Object.create(r.NumericalReal.prototype),r.Rational.prototype.constructor=r.Rational,r.Rational.prototype.__defineGetter__("value",function(){return this.a/this.b}),r.Rational.prototype["+"]=function(a){return this.a===0?a:a instanceof r.Rational?new r.Rational(this.a*a.b+this.b*a.a,this.b*a.b):a.constructor===r.NumericalComplex?new r.NumericalComplex(this.value+a._real,a._imag):a.constructor===r.List.ComplexCartesian?a["+"](this):a.constructor===r.List.ComplexPolar?a["+"](this):a.constructor===r.List.Real?a["+"](this):a.constructor===r.Symbol.Real?a["+"](this):a.constructor===r.List?a["+"](this):(console.warn("Swapped operator order for + with Rational"),a["+"](this))},r.Rational.prototype["-"]=function(a){return this.a===0?a["@-"]():a instanceof r.Rational?new r.Rational(this.a*a.b-this.b*a.a,this.b*a.b):a.constructor===r.NumericalComplex?new r.NumericalComplex(this.value-a._real,a._imag):a.constructor===r.List.ComplexCartesian?a["@-"]()["+"](this):a.constructor===r.List.ComplexPolar?a["@-"]()["+"](this):a.constructor===r.List.Real?a["@-"]()["+"](this):a.constructor===r.Symbol.Real?a["@-"]()["+"](this):a.constructor===r.List?a["@-"]()["+"](this):(console.warn("Swapped operator order for - with Rational"),a["+"](this))},r.Rational.prototype["*"]=function(a){return this.a===0?h.Zero:a instanceof this.constructor?new r.Rational(this.a*a.a,this.b*a.b):this.__proto__.__proto__["*"].call(this,a)},r.Rational.prototype["/"]=function(a){if(this.a===0)return h.Zero;if(a instanceof this.constructor){if(a.a===0)throw"Division By Zero is not defined for Rational numbers!";return(new r.Rational(this.a*a.b,this.b*a.a)).reduce()}return r.NumericalReal.prototype["/"].call(this,a)},r.Rational.prototype["^"]=function(a){if(a===h.Zero)return h.One;if(a===h.One)return this;if(this.a===0)return h.Zero;if(this.a===this.b)return h.One;if(a instanceof r.Integer)return new r.Rational(Math.pow(this.a,a.a),Math.pow(this.b,a.a));if(a instanceof r.Rational){var b=a.reduce();return b.a%2==0?new r.NumericalReal(Math.pow(Math.pow(this.a,b.a),1/b.b)):r.NumericalReal.prototype["^"].call(this,a)}return r.List([this,a],"^")},r.Rational.prototype.reduce=function(){function a(b,c){return c===0?b:a(c,b%c)}var b=a(this.b,this.a);return this.a/=b,this.b/=b,this.b===1?new r.Integer(this.a):this},r.Integer=function(b){this.a=b},r.Integer.prototype=Object.create(r.Rational.prototype),r.Integer.prototype.b=1,r.Integer.prototype.constructor=r.Integer,r.Integer.prototype["+"]=function(a){return a instanceof r.Integer?new r.Integer(this.a+a.a):a["+"](this)},r.Integer.prototype["-"]=function(a){return a instanceof r.Integer?new r.Integer(this.a-a.a):this.__proto__.__proto__["-"].call(this,a)},r.Integer.prototype["/"]=function(a){return a instanceof r.Integer?this.a%a.a===0?new r.Integer(this.a/a.a):new r.Rational(this.a,a.a):this.__proto__.__proto__["/"].call(this,a)},r.Integer.prototype["@-"]=function(){return new r.Integer(-this.a)},r.Integer.prototype["*"]=function(a){return a instanceof r.Integer?new r.Integer(this.a*a.a):a["*"](this)},r.Integer.prototype["^"]=function(a){if(a instanceof r.Integer)return new r.Integer(Math.pow(this.a,a.a));if(a.constructor===r.Rational){var b=a.reduce();return b.a%2==0?new r.NumericalReal(Math.pow(Math.pow(this.a,b.a),1/b.b)):r.NumericalReal.prototype["^"].call(this,a)}if(a.constructor===r.List.Real||a.constructor===r.Symbol.Real)if(this.a>0)return r.List.Real([this,a],"^");return r.NumericalReal.prototype["^"].call(this,a)},r.Integer.prototype["%"]=function(a){return a instanceof r.Integer?new r.Integer(this.a%a.a):a.constructor===r.Rational?new r.Rational:a.constructor===r.NumericalReal?new r.NumericalReal(this%a.value):r.List.Real([this,a],"%")},r.List.prototype.differentiate=function(a){switch(this.operator){case b:if(this[0]instanceof r.Function){var c=this[1].differentiate(a);return c===h.Zero?c:this[0].differentiate().default(this[1])["*"](c)};case"*":return this[0].differentiate(a)["*"](this[1])["+"](this[1].differentiate(a)["*"](this[0]));case"@+":case"@-":return this[0].differentiate(a)[this.operator]();case"+":case"-":return this[0].differentiate(a)[this.operator](this[1].differentiate(a));case"^":var d=this[0].differentiate(a),e=this[1].differentiate(a);if(d===h.Zero)return e===h.Zero?h.Zero:e["*"](h.log.default(this[0]))["*"](this);var f=this[0]["^"](this[1]["-"](h.One));return f["*"](d["*"](this[1])["+"](this[0]["*"](h.log.default(this[0]))["*"](e)));case"/":var c=this[0].differentiate(a),g=this[1].differentiate(a);if(g===h.Zero)return c["/"](this[1]);return this[1]["*"](c)["-"](this[0]["*"](g))["/"](this[1]["^"](new r.Integer(2)));default:throw"Cannot differentiate "+this.operator+" operator."}},r.prototype.differentiateN=function(a,b){if(b===0)return this;if(b<=-1)return this.integrateN(a,b);if(b>1)return this.differentiate(a).differentiateN(a,b-1);if(b===1)return this.differentiate(a)},r.Root=function(b,c){this.a=b,this.n=c},r.Root.prototype=Object.create(r.NumericalReal),r.Root.constructor=r.Root,r.Root.prototype["*"]=function(a){if(a.constructor!==this.constructor)return a["*"](this)},r.Root.prototype.__defineGetter__("value",function(){return Math.pow(this.a,1/this.n)}),r.Equation=function(a,b){return a.__proto__=r.Equation.prototype,a.operator=b,a},r.Equation.prototype=Object.create(r.List.prototype),r.Equation.prototype.apply=function(a,b){throw"Operators cannot be applied to equations"},r.List.ComplexPolar=function(a){return a.__proto__=r.List.ComplexPolar.prototype,a},r.List.ComplexPolar.prototype=Object.create(r.prototype),r.List.ComplexPolar.prototype.polar=function(){return this},r.List.ComplexPolar.prototype.realimag=function(){return r.List.ComplexCartesian([this[0].apply("*",h.cos.apply(b,this[1])),this[0].apply("*",h.sin.apply(b,this[1]))])},r.List.ComplexPolar.prototype.real=function(){return this[0].apply("*",h.cos.apply(b,this[1]))},r.List.ComplexPolar.prototype.imag=function(){return this[0].apply("*",h.sin.apply(b,this[1]))},r.List.ComplexPolar.prototype.conjugate=function(){return r.List.ComplexPolar([this[0],this[1].apply("@-")])},r.List.ComplexPolar.prototype.differentiate=function(a){return h.e.apply("^",h.i.apply("*",this[1])).apply("*",this[0].differentiate(a).apply("+",h.i.apply("*",this[0]).apply("*",this[1].differentiate(a))))},r.List.ComplexPolar.prototype.apply=function(a,c){if(c.constructor===this.constructor)switch(a){case b:case"*":return r.List.ComplexPolar([this[0].apply("*",c[0]),this[1].apply("+",c[1])]);case"/":return r.List.ComplexPolar([this[0].apply("/",c[0]),this[1].apply("-",c[1])]);case"+":case"-":case"^":case"!":default:}else if(c.constructor===r.NumericalReal)switch(a){case b:case"*":return r.List.ComplexPolar([this[0].apply("*",c),this[1]]);case"/":return r.List.ComplexPolar([this[0].apply("/",c),this[1]]);case"+":case"-":case"^":return r.List.ComplexPolar([this[0],this[1].apply("*",c)]);case"!":default:}else if(c.constructor===r.Complex)switch(a){case b:case"*":return r.List.ComplexPolar([this[0].apply("*",new r.NumericalReal(c._real)),this[1].apply("+",new r.NumericalReal(c._imag))]);case"/":return r.List.ComplexPolar([this[0].apply("/",new r.NumericalReal(c._real)),this[1].apply("-",new r.NumericalReal(c._imag))]);case"+":case"-":case"^":case"!":default:}},r.List.ComplexPolar.prototype.abs=function(){return this[0]},r.List.ComplexPolar.prototype.arg=function(){return this[1]},r.List.ComplexPolar.prototype.constructor=r.List.ComplexPolar,r.prototype.real=function(){return console.warn("TODO: don't calculate both parts (Expression.prototype.real)"),this.realimag()[0]},r.prototype.imag=function(){return console.warn("TODO: don't calculate both parts (Expression.prototype.imag)"
),this.realimag()[1]},r.List.prototype.realimag=function(){console.error("Only the user can call this function");switch(this.operator){case b:if(this[0]instanceof r.Function)return this[0].realimag().default(this[1]);case"*":var a=this[0].realimag(),c=this[1].realimag();return r.List.ComplexCartesian([a[0]["*"](c[0])["-"](a[1]["*"](c[1])),a[0]["*"](c[1])["+"](a[1]["*"](c[0]))]);case"@+":case"@-":var a=this[0].realimag();return r.List.ComplexCartesian([a[0][this.operator](),a[1][this.operator]()]);case"+":case"-":var a=this[0].realimag(),c=this[1].realimag();return r.List.ComplexCartesian([a[0][this.operator](c[0]),a[1][this.operator](c[1])]);case"/":var a=this[0].realimag(),c=this[1].realimag(),d=c[0]["*"](c[0])["+"](c[1]["*"](c[1]));return r.List.ComplexCartesian([a[0]["*"](c[0])["+"](a[1]["*"](c[1]))["/"](d),a[1]["*"](c[0])["-"](a[0]["*"](c[1]))["/"](d)]);case"^":var a=this[0].realimag(),c=this[1].realimag(),e=new r.Rational(1,2),f=new r.Integer(2),g=h.log.realimag().default(a),i=g[0],j=g[1],k=i["*"](c[1])["+"](j["*"](c[0])),l=h.e["^"](i["*"](c[0])["-"](j["*"](c[1])));return r.List.ComplexCartesian([l["*"](h.cos.default(k)),l["*"](h.sin.default(k))])}},r.List.ComplexCartesian=function(b){return b.__proto__=r.List.ComplexCartesian.prototype,b},r.List.ComplexCartesian.prototype=Object.create(r.prototype),r.List.ComplexCartesian.prototype.constructor=r.List.ComplexCartesian,r.List.ComplexCartesian.prototype.realimag=function(){return this},r.List.ComplexCartesian.prototype.real=function(){return this[0]},r.List.ComplexCartesian.prototype.imag=function(){return this[1]},r.List.ComplexCartesian.prototype.conjugate=function(){return r.List.ComplexCartesian([this[0],this[1].apply("@-")])},r.List.ComplexCartesian.prototype["@-"]=function(a){return new r.List.ComplexCartesian([this[0]["@-"](),this[1]["@-"]()])},r.List.ComplexCartesian.prototype["*"]=function(a){if(a instanceof r.List.ComplexCartesian)return new r.List.ComplexCartesian([this[0]["*"](a[0])["+"](this[1]["*"](a[0])),this[0]["*"](a[1])["-"](this[1]["*"](a[1]))]);if(a instanceof r.List.Real||a instanceof r.Symbol.Real||a instanceof r.NumericalReal)return new r.List.ComplexCartesian([this[0]["*"](a),this[1]["*"](a)])},r.List.ComplexCartesian.prototype["^"]=function(a){if(a instanceof r.Integer){if(a instanceof r.Rational&&a.a===a.b)return this;if(a instanceof r.Rational&&a.a===0)return h.One;var b=a.a,c,a=this[0],d=this[1],e=new r.Integer(-1),f=h.Zero,g=a["^"](new r.Integer(b)),i=1;for(c=1;;c++){if(c===b){var j=d["^"](new r.Integer(c));i===0?g=g["+"](j):i===1?f=f["+"](j):i===2?g=g["-"](j):i===3&&(f=f["-"](j),i=-1);break}var j=a["^"](new r.Integer(b-c))["*"](d["^"](new r.Integer(c)));i===0?g=g["+"](j):i===1?f=f["+"](j):i===2?g=g["-"](j):i===3&&(f=f["-"](j),i=-1),i++}return new r.List.ComplexCartesian([g,f])}return new r.List([this,a],"^")},r.List.ComplexCartesian.prototype["+"]=function(a){if(a instanceof r.List.ComplexCartesian)return new r.List.ComplexCartesian([this[0]]);if(a instanceof r.List.Real||a instanceof r.Symbol.Real||a instanceof r.NumericalReal)return new r.List.ComplexCartesian([this[0]["+"](a),this[1]])},r.List.ComplexCartesian.prototype.differentiate=function(a){return r.List.ComplexCartesian([this[0].differentiate(a),this[1].differentiate(a)])},r.List.ComplexCartesian.prototype.apply=function(c,d){if(d.constructor===this.constructor)switch(c){case"+":case"-":return r.List.ComplexCartesian([this[0].apply(c,d[0]),this[1].apply(c,d[1])]);case b:case"*":return r.List.ComplexCartesian([this[0].apply("*",d[0]).apply("-",this[1].apply("*",d[1])),this[0].apply("*",d[1]).apply("+",this[1].apply("*",d[0]))]);case"/":var e=d[0].apply("*",d[0]).apply("+",d[1].apply("*",d[1]));return r.List.ComplexCartesian([this[0].apply("*",d[0]).apply("+",this[1].apply("*",d[1])).apply("/",e),this[1].apply("*",d[0]).apply("-",this[0].apply("*",d[1])).apply("/",e)]);case"^":var f=new r.NumericalReal(.5,0),g=f.apply("*",h.log.apply(b,this[0].apply("*",this[0]).apply("+",this[1].apply("*",this[1])))),i=h.atan2.apply(b,r.Vector([this[1],this[0]])),j=g.apply("*",d[1]).apply("+",i.apply("*",d[0])),k=h.e.apply("^",g.apply("*",d[0]).apply("-",i.apply("*",d[1])));return r.List.ComplexCartesian([k.apply("*",h.cos.apply(b,j)),k.apply("*",h.sin.apply(b,j))]);case"!":default:}else if(d.constructor===r.List.ComplexPolar)switch(c){case"*":case"/":var e=d[0].apply("*",d[0]),l=d.realimag();return r.List.ComplexCartesian([this[0].apply("*",l[0]).apply("+",a[1].apply("*",l[1])).apply("/",e),this[1].apply("*",l[0]).apply("-",a[0].apply("*",l[1])).apply("/",e)]);case"^":case"+":case"-":return this.apply(c,d.realimag())}else{if(d.constructor===r.Complex)return this.apply(c,d.realimag());if(d.constructor===r.Symbol.Real)return console.error("Duplicated an x! This makes it difficult to solve complex equations, I think"),this.apply(c,d.realimag());if(d.constructor===r.List.Real)return console.error("Duplicated an x! This makes it difficult to solve complex equations, I think"),this.apply(c,d.realimag())}throw"CMPLX.LIST * "+c},r.List.Real=function(c,d){return c.__proto__=r.List.Real.prototype,d!==b&&(c.operator=d),c},r.List.Real.prototype=Object.create(r.List.prototype),r.List.Real.prototype.realimag=function(){return r.List.ComplexCartesian([this,h.Zero])},r.List.Real.prototype.real=function(){return this},r.List.Real.prototype.imag=function(){return h.Zero},r.List.Real.prototype.polar=function(){return r.List.ComplexPolar([r.List.Real([h.abs,this]),r.List.Real([h.arg,this])])},r.List.Real.prototype.abs=function(){return r.List.Real([h.abs,this])},r.List.Real.prototype.arg=function(){return r.List.Real([h.arg,this])},r.List.Real.prototype["+"]=function(a){return this===a?a["*"](new r.Integer(2)):a instanceof r.Rational&&a.a===0?this:a instanceof r.NumericalReal?this.operator==="+"&&this[1]instanceof r.NumericalReal?r.List.Real([this[0],this[1]["+"](a)],this.operator):this.operator==="-"&&this[1]instanceof r.NumericalReal?r.List.Real([this[0],a["-"](this[1])],"+"):r.List.Real([this,a],"+"):a instanceof r.List.Real||a instanceof r.Symbol.Real?r.List.Real([this,a],"+"):a["+"](this)},r.List.Real.prototype["-"]=function(a){return a instanceof r.Rational&&a.a===0?this:a===this?h.Zero:a instanceof r.List.Real?a.operator==="@-"?r.List.Real([this,a[0]],"+"):r.List.Real([this,a],"-"):a instanceof r.Symbol.Real||a instanceof r.NumericalReal?r.List.Real([this,a],"-"):this.realimag()["-"](a)},r.List.Real.prototype["*"]=function(a){return a instanceof r.Rational&&a.a===a.b?this:a instanceof r.Rational&&a.a===0?h.Zero:a instanceof r.NumericalReal?this.operator==="*"||this.operator==="/"&&this[0]instanceof r.NumericalReal?r.List.Real([this[0]["*"](a),this[1]],this.operator):r.List.Real([a,this],"*"):a instanceof r.List.Real||a instanceof r.Symbol.Real?(!(this[0]instanceof r.Function),r.List.Real([this,a],"*")):a["*"](this)},r.List.Real.prototype["/"]=function(a){return a instanceof r.Rational&&a.a===a.b?this:a===this?h.One:a instanceof r.NumericalReal?this.operator==="*"||this.operator==="/"?r.List.Real([this[0]["/"](a),this[1]],this.operator):r.List.Real([this,a],"/"):a instanceof r.List.Real||a instanceof r.Symbol.Real?r.List.Real([this,a],"/"):this.realimag()["/"](a)},r.List.Real.prototype["@-"]=function(){return this.operator==="@-"?this[0]:r.List.Real([this],"@-")},r.List.Real.prototype["^"]=function(a){if(a instanceof r.NumericalReal)if(this.operator==="*"||this.operator==="/"&&this[0]instanceof r.NumericalReal)return r.List.Real([this[0]["^"](a),this[1]["^"](a)],this.operator);return r.Symbol.Real.prototype["^"].call(this,a)},r.List.Real.prototype.constructor=r.List.Real,r.prototype.polar=function(){var a=this.realimag(),b=new r.Integer(2);return r.List.ComplexPolar([h.sqrt.default(a[0]["^"](b)["+"](a[1]["^"](b))),h.atan2.default(r.Vector([a[1],a[0]]))])},r.prototype.abs=function(){console.warn("SLOW?");var a=this.realimag(),b=new r.Integer(2);return h.sqrt.default(a[0]["^"](b)["+"](a[1]["^"](b)))},r.prototype.arg=function(){console.warn("Slow?");var a=this.realimag();return h.atan2.default(r.Vector([a[1],a[0]]))},r.prototype.factors=function(a,b,c){c(this,!1)},r.prototype.terms=function(a,b,c){c(this,!1)},r.prototype.factorize=function(a){throw"Inefficent";var b,c},r.Symbol.Real.prototype.factors=function(a,b,c){a.indexOf(this)!==-1?b(this,!1):c(this,!1)},r.Symbol.Real.prototype.terms=function(a,b,c){a.indexOf(this)!==-1?b(this,!1):c(this,!1)},r.List.Real.prototype.terms=function(a,b,c){switch(this.operator){case"+":this[0].terms(a,b,c),this[1].terms(a,b,c);return;case"-":this[0].terms(a,b,c),this[1].terms(a,function(a){b(a["@-"]())},function(a){c(a["@-"]())});return;case"*":var d=[],e=h.Zero,f=[],g=h.Zero;this[0].terms(a,function(a){d.push(a)},function(a){e=e["*"](a)}),this[1].terms(a,function(a){f.push(a)},function(a){g=g["*"](a)}),c(e["*"](g));var i=0;for(i=0;i<d.length;i++){var j;for(j=0;j<f.length;j++)b(d[i]["*"](f[j]))}return;case"/":var k=this;if(this[1]instanceof r.Constant){this[0].terms(a,function(a){b(a["/"](k[1]))},function(a){c(a["/"](k[1]))});return}throw"Expansion in denominator required"}},r.List.Real.prototype.factors=function(a,c,d,e){var f=~~(1e3*Math.random());console.log("("+f+") Attempt to find factors of: ",this);switch(this.operator){case"-":case"+":var g=[],i=h.One,j=[],k=h.One;this[0].factors(a,function(a){console.log(f+"< a: ",a),g.push(a)},function(a){console.log(f+"< a_c: ",a),i=i["*"](a)}),this[1].factors(a,function(a){console.log(f+"< b: ",a),j.push(a)},function(a){console.log(f+"< b_c: ",a),k=k["*"](a)});var l=[],m,n=g.length,o,p=j.length,q=h.One,r=h.One;for(m=0;m<n;m++){var s=!1;for(o=0;o<p;o++){if(j[o]===b)continue;if(g[m]===j[o]){l.push(g[m]),j[o]=b,s=!0;break}}s||(q=q["*"](g[m]))}for(o=0;o<p;o++){if(j[o]===b)continue;r=r["*"](j[o])}l.length?(console.log("common:",l,"of: ",g,j),l.forEach(c),console.log("(a,b) = ",q,r),console.log("(a_c,b_c) = ",i,k),c(q["*"](i)["+"](r["*"](k)))):d(this);return;case"*":this[0].factors(a,c,d),this[1].factors(a,c,d);return;case"/":this[0].factors(a,c,d);if(e===!1)return;this[1].factors(a,function(a,b){c(a,!b)},function(a,b){d(a,!b)});return}},window.test=function(a){E(a||"x+x+x+x",c).factors([c.x],function(a){console.log("Y",a)},function(a){console.log("N",a)})},function(){r.prototype.factors=function(a){return new Multiset},r.Symbol.Real.prototype.factors=function(a){var b=new Multiset([this],[1]);return b.vars=[],b},r.List.Real.prototype.factors=function(a){switch(this.operator){case"+":case"-":var b=this[0].factors(a),c=this[0].factors(a);return this.operator==="-"&&c.add(h.One["@-"]()),Multiset([this],[1]);case"*":var b=this[0].factors(a),c=this[1].factors(a);return b.union(c);case"/":var b=this[0].factors(a),c=this[1].factors(a).map(h.One["/"]);return b.union(c);case"@-":return Multiset(this[0].factors(a).add(h.One["@-"]()))}}},r.prototype.roots=function(a){return t([])},r.Symbol.prototype.roots=function(a){return a.indexOf(this)!==-1?t([new Statement(this,h.Zero,"=")]):t([])},r.prototype.dep=function(a){return!1},r.Symbol.Real.prototype.dep=function(a){return a.indexOf(this)!==-1},r.List.prototype.dep=function(a){return this[0].dep(a)?!0:this[1].dep(a)?!0:!1},r.Function.Symbolic.prototype.inverse=function(){},r.List.Real.prototype.roots=function(a){if(this.operator==="*"){var b=this[0].roots(a),c=this[1].roots(a);return b.union(c)}if(this.operator==="+"){var d=h.One;this.factors(a,function(a,b){d=d["*"](a)},function(){},!1);if(d.operator==="*")return d.roots(a);if(!!this[1].dep(a)&&!!this[0].dep(a))throw"Cannot solve";var e=this[0].roots(a),f=this[0].roots(a)}else if(this.operator==="/"){var b=this[0].roots(a);return b}},u.prototype=Object.create(r.prototype),u.prototype.constructor=u,u.prototype["+"]=function(a){if(a instanceof u)throw"Infinitesimal addition";return a},u.prototype["/"]=function(a){if(a instanceof u){if(a.x instanceof r.Symbol)return this.x.differentiate(a.x);throw"Confusing infitesimal division"}return this.x=this.x["/"](a),this},u.prototype["*"]=function(a){if(a instanceof u)return h.Zero;this.x=this.x["*"](a)},u.prototype.s=function(a){if(a!=="text/latex")throw"Infinitesimal numbers cannot be exported to programming languages";var b=this.x.s(a),c=m.precedence("default");return c>b.p&&(b.s="\\left("+b.s+"\\right)"),b.update("d"+b.s,c)},v.prototype=Object.create(r.Function.prototype),v.prototype.constructor=v,v.prototype.default=function(a){return a.differentiate(this.x)},r.List.prototype.lim=function(a,b){switch(this.operator){case"+":case"-":return this[0].lim(a,b)[this.operator](this[1].lim(a,b));case"@-":case"@+":return this[0].lim(a,b)[this.operator]();case"/":var c=this[0].sub(a,b),d=this[1].sub(a,b);if(c===h.Zero&&d===h.Zero)return c=this[0].differentiate(a),d=this[1].differentiate(a),c["/"](d).lim(a,b);return c["/"](d);case"*":var e=this[0].sub(a,b),f=this[1].sub(a,b);if(e===h.Zero&&f==h.Infinity){var c=this[0].differentiate(a),d=h.One["/"](this[1]).differentiate(a);return c["/"](d).lim(a,b)}if(f===h.Zero&&e==h.Infinity){var c=this[0].differentiate(a),d=h.One["/"](this[1]).differentiate(a);return c["/"](d).lim(a,b)}return e["*"](f);case"^":if(this[0]===h.Zero)return h.Zero;if(this[1]===h.Zero&&this[0]!==h.Zero)return h.One;return this.sub(a,b);case"!":return this.sub(a,b)}},r.Vector=function(a){return a.__proto__=r.Vector.prototype,a},r.Vector.prototype=Object.create(r.prototype),r.Vector.prototype.constructor=r.Vector,r.Vector.prototype[","]=function(a){return this[this.length]=a,this},r.Vector.prototype.differentiate=function(a){return r.Vector(Array.prototype.map.call(this,function(b){return b.differentiate(a)}))},r.Vector.prototype.cross=function(a){if(this.length!==3||a.length!==3)throw"Cross product only defined for 3D vectors.";return new r.Vector([this[1]["*"](a[2])["-"](this[2]["*"](a[1])),this[2]["*"](a[0])["-"](this[0]["*"](a[2])),this[0]["*"](a[1])["-"](this[1]["*"](a[0]))])},r.Vector.prototype.default=function(a){var b=this.length;if(a instanceof r.Vector){if(b!==a.length)throw"Vector Dimension mismatch.";var c,d=h.Zero;for(c=0;c<b;c++)d=d["+"](this[c]["*"](a[c]));return d}if(!(a instanceof r.Matrix))return r.Vector(Array.prototype.map.call(this,function(b){return b["*"](a)}))},r.Vector.prototype["*"]=r.Vector.prototype.default,r.Vector.prototype["+"]=function(a,b){var c=this.length;if(c!=a.length)throw"Vector Dimension mismatch.";var d,f=new Array(c);for(d=0;d<c;d++)f[d]=this[d][b||"+"](e[d]);return r.Vector(f)},r.Vector.prototype["-"]=function(a){return r.Vector.prototype.call(this,a,"-")},r.Vector.prototype["/"]=function(a){if(a instanceof r.Vector)throw"Vector division not defined";return r.Vector(Array.prototype.map.call(this,function(b){return b["/"](a)}))},r.Vector.prototype["^"]=function(a){if(a instanceof r.Integer){if(a.a===0)throw"Raised to zero power";if(a.a===1)return this;if(a.a===2){var b=h.Zero,c,d=this.length;for(c=0;c<d;c++)b=b["+"](this[c]["^"](a));return b}return this["^"](new r.Integer(a.a-1))["*"](this)}if(a instanceof r.Rational)return this["^"](a.a)["^"](h.One["/"](a.b));if(a.constructor===r.NumericalComplex)return new r.Complex(this.value+a._real,a._imag);if(a.constructor===r.List.ComplexCartesian)return a["+"](this);if(a.constructor===r.List.ComplexPolar)return a["+"](this);if(a.constructor===r.List.Real)return a["+"](this);if(a.constructor===r.Symbol.Real)return a["+"](this);if(a.constructor===r.List)return a["+"](this);throw"Unknown Type for Vector ^"},r.Vector.prototype.apply=function(a,c){var d=this.length;switch(a){case",":return this[d]=c,this;case b:case"*":if(d!=c.length)throw"Vector Dimension mismatch.";var e,f=E.Global.Zero;for(e=0;e<d;e++)f=f.apply("+",this[e].apply("*",c[e]));return f;case"+":case"-":if(d!=c.length)throw"Vector Dimension mismatch.";var e,g=new Array(d);for(e=0;e<d;e++)g[e]=this[e].apply(a,c[e]);return r.Vector(g);case"/":case"^":default:throw"Vector operation not allowed."}},r.Vector.prototype.realimag=function(){var a=this.length,b=new Array(a),c=new Array(a),d;for(d=0;d<a;d++){var e=this[d].realimag();b[d]=e[0],c[d]=e[1]}return r.List.ComplexCartesian([r.Vector(b),r.Vector(c)])},r.Matrix=function(a,b,c){return a.__proto__=r.Matrix.prototype,a.rows=b,a.cols=c,a},window.M4=r.Matrix,r.Matrix.prototype=Object.create(r.prototype),r.Matrix.prototype.constructor=r.Matrix,r.Matrix.prototype.default=r.Matrix.prototype["*"]=function(a){if(a.constructor===r.Matrix){if(a.rows!==this.cols)throw"Matrix dimensions do not match.";var b=[],c,d,e,f=0;for(c=0;c<this.rows;c++)for(d=0;d<a.cols;d++){var g=h.Zero;for(e=0;e<a.rows;e++)g=g["+"](a[e*a.cols+d]);b[f++]=g}return r.Matrix(b)}throw"Unknown type"},r.Matrix.prototype.reduce=function(a){var b,c;for(c=0;c<this.rows;c++)for(b=0;b<c;b++){var d=this[b*this.cols+b];if(d===h.Zero)throw"Row swap!";var e=this[c*this.cols+b]["/"](d),f;for(f=b+1;f<this.cols;f++)this[c*this.cols+f]=this[c*this.cols+f]["-"](e["*"](this[b*this.cols+f]))}return this},r.Sum=function(b,c,d,e){this.x=b,this.f=e,this.a=c,this.b=d},r.Sum.prototype=Object.create(r.Symbol.prototype),r.Sum.prototype.constructor=r.Sum,r.Sum.prototype.s=function(a){if(a==="text/latex"){var b=this.f.s(a),c=this.a.s(a),d=this.b.s(a),e=this.x.s(a),f=b.s,g=b;return g=b.merge(c),g=b.merge(d),g.merge(e,"\\sum_{"+e.s+"="+c.s+"}^{"+d.s+"}"+f,m.precedence("*"))}if(a==="text/javascript"){var c=this.a.s(a),d=this.b.s(a);if(this.x instanceof r.Symbol.Real){var e=this.x.s(a),g=e.merge(c).merge(d),h=g.var(),i=g.var(),j=g.var(),k=g.var(),l=this.f.sub(this.x,new r.Symbol.Real(h)),b=l.s(a),n="var "+i+" = 0, "+h+", "+k+" = "+c.s+", "+j+" = "+d.s+";\nif("+j+" === Infinity) {\n\t"+j+" = 1000;\n}\nif (!("+j+" >= "+k+')) {\n\tthrow("Halting problem solved.")\n}\nfor('+h+" = "+k+"; "+h+" < "+j+"; "+h+"++) {\n\t"+i+" +="+b.s+";\n}\n";return g.merge(b,i,Infinity,n)}throw"Can only sum over reals in javascript"}},r.Sum.prototype["^"]=function(a){if(this.b_locked)throw"Sum was upper bounded twice!";return this.b=a,this.b_locked=!0,this},r.Sum.prototype.default=function(a){if(!this.b_locked)throw"Sum was not upper bounded!";if(this.f_locked)throw"Sum already defined";return this.f=a,this.f_locked=!0,this},r.List.prototype.expand=function(a){var b=1,c=-1,d=h.Zero,e=h.Zero;throw"Should be async, don't use this"},r.prototype.simplify=function(){return this},r.prototype.integrate=function(a){throw"Could not integrate expression."},r.prototype.integrateN=function(a,b){if(b===0)return this;if(b<=-1)return this.differentiateN(a,b);if(b>1)return this.integrate(a).integrateN(a,b-1);if(b===1)return this.integrate(a)};var w={"void":1,vec3:2,bool:6,"int":3,fp:4,vec2:5,vec4:7,mat2:10,mat3:11,mat4:12,func:20},x={Boolean:1,Number:2,String:3,"undefined":4,Object:5,Function:w.func,Array:7,ref:8},z={"text/javascript":function(a,c){function d(a){return"("+a+")"}function f(a){return a.p<=e?d(a.s):a.s}var e=a===b?m.precedence("default"):m.precedence(a);switch(a){case"=":return{s:f(c[0])+a+f(c[1]),t:x.assignment,p:e};case"&&":case"<":case">":case">=":case"<=":case"!==":case"!=":case"==":case"===":return{s:f(c[0])+a+f(c[1]),t:x.Boolean,p:e};case"+":case"-":case"/":case"*":case"?":case":":case",":case">>":case"<<":case"&":case"%":return{s:f(c[0])+a+f(c[1]),t:x.Number,p:e};case"_":if(c[0].t!==x.ref||c[1].t!==x.ref&&c[1].t!=x.Number)throw"Operator '_' does not exist in javaScript for those types.";return{s:f(c[0])+a+f(c[1]),t:x.ref,p:e};case"~":return{s:a+f(c[0]),t:x.Number,p:e};case"@-":case"@+":return{s:a.substring(1)+f(c[0]),t:x.Number,p:e};case"^":return{s:"Math.pow("+c[0].s+","+c[1].s+")",t:x.Number,p:e};case b:return c[0].t===x.Function?{s:c[0].s+"("+c[1].s+")",t:x.Number,p:e}:(e=m.precedence("*"),{s:f(c[0])+"*"+f(c[1]),t:x.Number,p:e});case"#":return{s:"function(x){return "+c[0].s+"}",t:x.Function,p:e};case"√":return{s:"Math.sqrt("+c[0].s+")",t:x.Number,p:e};case"!":return{s:"factorial("+c[1].s+")",t:x.Number,p:e};default:throw"Could not translate operator: '"+a+"' into javscript!"}},"x-shader/x-fragment":function(a,c){function d(a){return"("+a+")"}function f(a){return a.p<=e?d(a.s):a.s}var e=a===b?m.precedence("default"):m.precedence(a);switch(a){case"&&":case"||":if(c[0].t===c[1].t&&c[1].t===w.bool)return{s:f(c[0])+a+f(c[1]),t:w.bool,p:e};throw"Operands must also be boolean values";case"==":case"<":case">":case"<=":case">=":case"!=":if(c[0].t!==c[1].t)throw"The equality operators and assignment operator are only allowed if the two operands are same size and type.";return{s:f(c[0])+a+f(c[1]),t:w.bool,p:e};case":":if(c[0].t!==c[1].t)throw"Switching groups must be the same type";return{s:f(c[0])+a+f(c[1]),t:c[1].t,p:e};case"?":if(c[0].t!==w.bool)throw"Must be boolean type";return{s:f(c[0])+a+f(c[1]),t:c[1].t,p:e};case"+":case"-":case",":if(c[0].t!==c[1].t)throw"Types don't match: "+c[0].t+", "+c[1].t;return{s:f(c[0])+a+f(c[1]),t:w.fp,p:e};case"*":case"/":return{s:f(c[0])+a+f(c[1]),t:w.fp,p:e};case"_":throw"Write this later.";case"~":return{s:a+f(c[0]),t:x.Number,p:e};case"@-":case"@+":return{s:a.substring(1)+f(c[0]),t:w.fp,p:e};case"^":if(c[0].s==="2.718281828459045e+0")return{s:"exp("+c[1].s+")",t:w.fp,p:e};return{s:"pow("+c[0].s+","+c[1].s+")",t:w.fp,p:e};case b:return c[0].t===w.func?{s:c[0].s+"("+c[1].s+")",t:w.fp,p:e}:(e=m.precedence("*"),{s:f(c[0])+"*"+f(c[1]),t:w.fp,p:e});case"#":throw"Anonymous functions not supported.";case"√":return{s:"sqrt("+c[0].s+")",t:w.fp,p:e};case"!":return{s:"factorial("+c[0].s+")",t:w.fp,p:e};case"%":return{s:"mod("+c[0].s+","+c[1].s+")",t:w.fp,p:e};case"&":case"|":case"~":case">>":case"<<":throw"Reserved";default:throw"Could not translate operator: '"+a+"' into glsl!"}},"text/latex":function(a,c){function d(a){return"\\left("+a+"\\right)"}function f(b,c){return c?b.p<e?d(b.s):b.s:b.p===e?m.assoc(a)===!0?b.s:d(b.s):b.p<=e?d(b.s):b.s}var e=a===b?m.precedence("default"):m.precedence(a);switch(a){case"/":return{s:"\\frac{"+c[0].s+"}{"+c[1].s+"}",t:x.Number,p:e};case"^":case"_":return{s:f(c[0])+a+"{"+c[1].s+"}",t:x.ref,p:e};case b:if(c[0].s==="\\sqrt")return{s:"\\sqrt{"+c[1].s+"}",t:x.Number,p:e};if(c[0].s==="\\abs")return{s:"\\left|"+c[1].s+"\\right|",t:x.Number,p:e};return{s:f(c[0],1)+" "+f(c[1],1),t:x.Number,p:e};case"#":return{s:a+d(c[0].s),t:x.Fumber};case",":return{s:"\\left("+c.map(f).join(a)+"\\right)",t:x.Array,p:e}}if(a[0]=="@")return{s:a[1]+f(c[0]),t:x.Number,p:e};if(m.postfix(a))return{s:f(c[0])+a,t:x.Number,p:e};var g=this,h={"*":" ","∨":"\\vee ","&&":"\\wedge ","±":"\\pm ","∘":"\\circ "};return{s:c.map(f).join(h[a]||a),t:x.Number,p:e}}},A=m;B.prototype.var=function(){return"t"+(this.vars++).toString(36)},B.prototype.merge=function(a,b,c,d){this.s=b,d&&this.pre.push(d);var e;return this.pre.push.apply(this.pre,a.pre),this.vars+=a.vars,this.p=c,this},B.prototype.update=function(a,b,c){return this.p=b,c&&this.pre.push(c),this.s=a,this},B.prototype.compile=function(a){return Function(a,this.pre.join("\n")+"return "+this.s)},r.List.prototype.s=function(a){if(a==="text/latex")return r.List.Real.prototype.s.call(this,a);throw"Use real(), imag(), or abs(), or arg() first."},r.List.Real.prototype.s=function(a){function c(b){return a==="text/latex"?"\\left("+b+"\\right)":"("+b+")"}function l(a){return k>a.p?c(a.s):a.s}if(this.operator===b){if(this[0]instanceof r.Function){if(this[0]===h.abs){var d=this[1].s(a);if(a==="text/latex")return d.update("\\left|"+d.s+"\\right|",Infinity);var e=this[0].s(a);return d.update(e.s+"("+d.s+")",Infinity)}var e=this[0].s(a);if(this[1]instanceof r.Vector){var f=Array.prototype.map.call(this[1],function(b){return b.s(a)}),g,i=f.map(function(a){return a.s}),j=e.s;for(g=0;g<f.length;g++)e.merge(f[g]);return e.update(j+c(i),m.precedence("default"))}var d=this[1].s(a);return e.merge(d,e.s+c(d.s),m.precedence("default"))}this.operator="*"}var k=m.precedence(this.operator);if(this.operator==="^"){if(a==="x-shader/x-fragment"){if(this[0]===h.e){var d=this[1].s(a);return d.update("exp("+d.s+")")}if(this[1]instanceof r.Integer&&this[1].a<5){var e=this[0].s(a),n=e.s,o=m.precedence("*");o>e.p&&(n="("+n+")");var p=n,g;for(g=1;g<this[1].a;g++)p+="*"+n;return e.update("("+p+")")}if(this[1]instanceof r.Rational){var q=this[1].a%2?!1:!0;if(q){var d=this[1].s(a),e=this[0].s(a);return e.merge(d,"pow("+e.s+","+d.s+")")}var d=this[1]["-"](h.One).s(a),e=this[0].s(a);return e.merge(d,"(("+e.s+") * pow("+e.s+","+d.s+"))")}if(this[0]instanceof r.NumericalReal){var d=this[1]["-"](h.One).s(a),e=this[0].s(a);return e.merge(d,"(("+e.s+") * pow("+e.s+","+d.s+"))")}var d=this[1]["-"](h.One).s(a),e=this[0].s(a);return e.merge(d,"(("+e.s+") * pow("+e.s+","+d.s+"))")}if(a==="text/javascript"){if(this[0]===h.e){var d=this[1].s(a);return d.update("Math.exp("+d.s+")")}if(this[1]instanceof r.Rational){var q=this[1].a%2?!1:!0;if(q){var d=this[1].s(a),e=this[0].s(a);return e.merge(d,"Math.pow("+e.s+","+d.s+")")}var d=this[1].s(a),e=this[0].s(a);return e.merge(d,"Math.pow("+e.s+","+d.s+")")}var d=this[1].s(a),e=this[0].s(a);return e.merge(d,"Math.pow("+e.s+","+d.s+")")}if(a==="text/latex"){var e=this[0].s(a),d=this[1].s(a);return e.merge(d,l(e)+"^"+"{"+d.s+"}")}}var e=this[0].s(a);if(this.operator[0]==="@")return e.update(this.operator[1]+l(e),k);var d=this[1].s(a);if(a==="text/latex"){if(this.operator==="/")return e.merge(d,"\\frac{"+e.s+"}{"+d.s+"}");if(this.operator==="*")return e.merge(d,l(e)+l(d),k)}return e.merge(d,l(e)+this.operator+l(d),k)},r.Statement.prototype.s=r.List.Real.prototype.s,r.Symbol.prototype.s=function(){return new B(this.symbol||"x_{free}")},r.NumericalReal.prototype.s=function(a){if(a==="x-shader/x-fragment"){var b=this.value.toExponential();return b.indexOf(".")===-1&&(b=b.replace("e",".e")),new B(b)}return new B(this.value.toString())},r.List.ComplexPolar.prototype.s=function(a){function d(a,b){return b>a.p?"\\left("+a.s+"\\right)":a.s}if(a!=="text/latex")throw"Exporting not supported for complex values.";var b=m.precedence("+"),c=m.precedence("*"),e=this[0].s(a),f=this[1].s(a);return e.merge(f,d(e,c)+""+"e^{i"+d(f,c))},r.List.ComplexCartesian.prototype.s=function(a){function c(a,b){return b>a.p?"\\left("+a.s+"\\right)":a.s}if(a!=="text/latex")throw"Exporting not supported for complex values.";var b=m.precedence("+"),d=this[0].s(a),e=this[1].s(a);return d.merge(e,c(d)+"+"+c(e,b)+"i",m.precedence("+"))},r.NumericalComplex.prototype.s=function(a){d("NumericalComplex.toTypedString????");if(a==="text/latex"){var b=this.realimag();if(this._real===0)return this._imag===1?new B("i"):this._imag===-1?new B("-i"):new B(b[1].s(m).s+"i");return this._imag===0?new B(b[0].s(m).s):this._imag===1?new B(b[0].s(m).s+" + i"):this._imag===-1?new B(b[0].s(m).s+" - i"):this._imag<0?new B(b[0].s(m).s+" + "+b[1].s(m).s+"i"):new B(b[0]+" + "+b[1].s(m).s+"i")}throw"Please use x.realimag()[0 /* or 1 */].toTypedString() to generate code."},r.Integer.prototype.s=function(a){return a==="x-shader/x-fragment"?new B(this.a.toString()+".0"):new B(this.a.toString())},r.Vector.prototype.s=function(a){var b=this.length,c="[",d="]";a==="x-shader/x-fragment"&&(c="vec"+this.length+"(",d=")");var e=this[0].s(a),f,g=[];for(f=0;f<b;f++){var h=this[f].s(a);g.push(h.s),e=e.merge(h)}return e.update(c+g.join(",")+d,Infinity)},r.prototype.compile=function(a){return this.s("text/javascript").compile(a)},r.Numerical=r.Complex,h.sin=new r.Function({"default":function(a){switch(a.constructor){case r.ComplexNumerical:var b=Math.exp(a._imag),c=(b+1/b)/2,d=(b-1/b)/2;return new r.ComplexNumerical(Math.sin(a._real)*c,Math.cos(a._real)*d);case r.NumericalReal:return new r.NumericalReal(Math.sin(a.value));case r.List.Real:case r.Symbol.Real:return r.List.Real([h.sin,a]);default:return r.List([h.sin,a])}},"text/latex":"\\sin","text/javascript":"Math.sin","x-shader/x-fragment":"sin",title:"Sine Function",description:"See http://en.wikipedia.org/wiki/Trigonometric_functions#Sine.2C_cosine.2C_and_tangent",examples:["\\sin (\\pi)"],related:["cos","tan"]}),h.cos=new r.Function({"default":function(a){switch(a.constructor){case r.Complex:var b=Math.exp(a._imag),c=(b+1/b)/2,d=(b-1/b)/2;return new r.Complex(Math.cos(a._real)*c,-Math.sin(a._real)*d);case r.NumericalReal:return new r.NumericalReal(Math.cos(a));case r.List.Real:case r.Symbol.Real:return r.List.Real([h.cos,a]);default:return r.List([h.cos,a])}},derivative:h.sin["@-"](),"text/latex":"\\cos","text/javascript":"Math.cos","x-shader/x-fragment":"cos",title:"Cosine Function",description:"Cosine Function desc",examples:["\\cos (\\pi)"],related:["sin","tan"]}),h.sin.derivative=h.cos,h.tan=new r.Function({symbolic:function(){}}),h.log=new r.Function({"default":function(a,b){if(a instanceof r.Integer&&a.a===1)return h.Zero;if(a instanceof r.Integer&&a.a===0)return h.Infinity["@-"]();if(a instanceof r.NumericalReal){var c=a.value;if(c>0)return new r.NumericalReal(Math.log(c))}return b&&b.positive?r.List.Real([h.log,a]):r.List([h.log,a])},realimag:function(a){return D},"text/latex":"\\log","text/javascript":"Math.log","x-shader/x-fragment":"log",title:"Natural Logarithm",description:"Base e. See http://en.wikipedia.org/wiki/Natural_logarithm",examples:["\\log (ye^(2x))"],related:["exp","Log"]});var C=new r.Rational(1,2),D=new r.Function({"default":function(a){return(new r.List.ComplexCartesian([h.log.default(a.abs()),a.arg()]))["*"](C)}});D.__proto__=h.log,h.atan2=new r.Function({"default":function(a){if(a instanceof r.Vector)return a[0]instanceof r.NumericalReal&&a[1]instanceof r.NumericalReal?new r.NumericalReal(Math.atan2(a[0].value,a[1].value)):new r.List.Real([h.atan2,a]);throw"atan only takes vector arguments"},apply_realimag:function(a,b){return[r.List([h.atan2,b]),E.Global.Zero]},"text/latex":"\\tan^{-1}","text/javascript":"Math.atan2","x-shader/x-fragment":"atan",toTypedString:function(a){return{s:this[a],t:x.Function}},title:"Two argument arctangent function",description:"Arctan(y, x). Will equal arctan(y / x) except when x and y are both negative. See http://en.wikipedia.org/wiki/Atan2"}),h.atan=h.atan2,h.Gamma={"default":function(a){function b(a){var b,c,d,e,f,g=[57.15623566586292,-59.59796035547549,14.136097974741746,-0.4919138160976202,3399464998481189e-20,4652362892704858e-20,-0.00009837447530487956,.0001580887032249125,-0.00021026444172410488,.00021743961811521265,-0.0001643181065367639,8441822398385275e-20,-0.000026190838401581408,36899182659531625e-22];if(a<=0)throw"bad arg in gammln";e=c=a,d=c+5.2421875,d=(c+.5)*Math.log(d)-d,f=.9999999999999971;for(b=0;b<14;b++)f+=g[b]/++e;return d+Math.log(2.5066282746310007*f/c)}if(a instanceof r.Integer){var c=a.a;if(c<0)return h.ComplexInfinity;if(c<15){var d=1,e=0;for(e=1;e<c;e++)d*=e;return new r.Integer(d)}return r.List.Real([h.Gamma,a])}if(a instanceof r.NumericalReal){var c=a.value;return c===0?h.Infinity:c<0?new r.NumericalReal(-Math.PI/(c*Math.sin(Math.PI*c)*Math.exp(b(-c)))):new r.NumericalReal(Math.exp(b(c)))}return!(a instanceof r.NumericalComplex),r.List([h.Gamma,a])},"text/latex":"\\Gamma","text/javascript":"M.Global.Gamma.f",toTypedString:function(a){return{s:this[a],t:x.Function}},title:"Gamma Function",description:"See http://en.wikipedia.org/wiki/Gamma_function",examples:["\\Gamma (x)","x!"],related:["Log","LogGamma"]},h.Re={"default":function(a){return a.real()},apply_realimag:function(a,b){return[b.real(),h.Zero]},"text/latex":"\\Re"},h.Im={"default":function(a){return a.imag()},distributed_under_differentiation:!0,apply_realimag:function(a,b){return[b.imag(),h.Zero]},"text/latex":"\\Im"},r.List.Real.prototype.positive=function(){if(this.operator==="+")return this[0].positive&&this[1].positive&&this[0].positive()&&this[1].positive();if(this.operator==="*")return this[0]===this[1]?!0:this[0].positive&&this[1].positive&&this[0].positive()&&this[1].positive();if(this.operator==="^"&&this[1]instanceof r.Rational){var a=this[1].reduce();if(a.a%2===0)return!0}return!1},r.NumericalReal.prototype.positive=function(){return this.value>0},h.sqrt=new r.Function({"default":function(a){if(a instanceof r.NumericalReal){var c=a.value;return c<0?new r.List.ComplexCartesian([h.Zero,new r.NumericalReal(Math.sqrt(c))]):new r.NumericalReal(Math.sqrt(c))}return a instanceof r.List.Real?a.positive()?r.List.Real([h.sqrt,a]):r.List([h.sqrt,a]):a instanceof r.List.ComplexPolar?new r.List.ComplexPolar([a[0],a[1]["/"](new r.Integer(2))]):a instanceof r.List.ComplexCartesian?new r.List([h.sqrt,a]):r.List([h.sqrt,a])},apply_realimag:function(a,b){return b["^"](new r.Rational(1,2)).realimag()},"text/latex":"\\sqrt","text/javascript":"Math.sqrt","x-shader/x-fragment":"sqrt",toTypedString:function(a){return{s:this[a],t:x.Function}},title:"Sqrt Function",description:"See http://en.wikipedia.org/wiki/Square_Root",examples:["\\sqrt (x^4)"],related:["pow","abs","mod"]}),h.abs=new r.Function({"default":function(a){return a.abs()},"text/latex":"\\abs","text/javascript":"Math.abs","x-shader/x-fragment":"abs",titie:"Absolute Value Function",description:"Abs"
,examples:["\\abs (-3)","\\abs (i+3)"],related:["arg","tan"]}),h.abs.derivative=function(){var a=new r.Symbol.Real,b=a["/"](a.abs());return new r.Function.Symbolic(b,[a])}(),h.arg={"default":function(a){return console.warn("ARG IS FOR USER INPUT ONLY. USE .arg()"),a.arg()},"text/latex":"\\arg","text/javascript":"Math.arg_real",toTypedString:function(a){return{s:this[a],t:x.Function}},titie:"Arg Function",description:"Arg",examples:["\\arg (-3)","\\arg (3)","\\arg(3+2i)"],related:["abs"]},h.e=new r.NumericalReal(Math.E,0),h.e.title="e",h.e.description="The transcendental number that is the base of the natural logarithm, approximately equal to 2.71828.",h.e.s=function(a){return a==="text/javascript"?new B("Math.E"):a=="text/latex"?new B("e"):new B("2.718281828459045")},h.pi=new r.NumericalReal(Math.PI,0),h.pi.title="Pi",h.pi.description="",h.pi.s=function(a){return a==="text/javascript"?new B("Math.PI"):a==="text/latex"?new B("\\pi"):new B("3.141592653589793")},h.tau=h.pi["*"](new r.Integer(2)),h.Infinity=new r.NumericalReal(Infinity,0),h.Infinity.title="Infinity",h.Infinity.description="",h.infty=h.Infinity,h.Zero=new r.Integer(0),h.Zero.title="Zero",h.Zero.description="Additive Identity",h.Zero["*"]=function(a){return h.Zero},h.Zero["+"]=function(a){return a},h.Zero["-"]=function(a){return a["@-"]()},h.One=new r.Integer(1),h.One.title="One",h.One.description="Multiplicative Identity",h.One["*"]=function(a){return a},h.log.derivative=new r.Function.Symbolic(h.One["/"](new r.Symbol.Real)),h.i=new r.List.ComplexCartesian([h.Zero,h.One]),h.i.title="Imaginary Unit",h.i.description="A number which satisfies the property <m>i^2 = -1</m>.",h.i.realimag=function(){return r.List.ComplexCartesian([h.Zero,h.One])},h.i["*[TODO]"]=function(a){},h.d=new r.Function({"default":function(a){return new u(a)}}),h.d["/"]=function(a){if(a instanceof u){if(a.x instanceof r.Symbol)return new v(a.x);if(a.x instanceof r.Vector)return r.Vector(Array.prototype.map.call(a.x,function(a){return new v(a)}));throw"Confusing infitesimal division"}throw"Dividing d by some large number."},h.sum=new r.Function({"default":function(a){return 3}}),h.sum._=function(a){var b=a[0],c=a[1];return new r.Sum(b,c)};var F=E;E=function(a,b){var c=new Date,d=F(a,b),e,f=100;for(e=0;e<f;e++)F(a,b);return console.log("M: ",a,(new Date-c)/f+"ms"),d},E.toString=function(){return"function M() {\n    /*!\n     *  Math JavaScript Library v3.0.0\n     *  https://github.com/aantthony/javascript-cas\n     *  \n     *  Copyright 2010 Anthony Foster. All rights reserved.\n     */\n    [awesome code]\n}"},E.Context=o,E.Expression=r,E.Global=h;var G={};E.register=function(a,b){if(r.prototype[a])throw"Method ."+a+" is already in use!";G[a]=b},E.load=function(a,b){G[a](E,r,b),delete G[a]},typeof module!="undefined"?module.exports=E:window.M=E,console.log("Load time:",new Date-f,"ms")})();